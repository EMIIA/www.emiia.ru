

























<!DOCTYPE html>
<html>
<head>



<meta charset="UTF-8">




<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">



<!-- PWA -->
<link rel="shortcut icon" href="https://sos.emiia.ai/vv.ico" type="image/x-icon">
<meta name="theme-color" content="#f8f9fa">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="https://sos.emiia.ai/vv.webmanifest">


<title>–ü–†–û–°–¢–†–ê–ù–°–¢–í–ï–ù–ù–´–ô –ò–ù–¢–ï–õ–õ–ï–ö–¢</title>


<!-- –≠—Ç–∏ —Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π, –¥–ª—è PWA –Ω–µ –≤–∞–∂–Ω—ã, –Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã -->
<meta property="og:type" content="website" />
<meta property="og:url" content="https://sos.emiia.ai/vv1.html" />
<meta property="og:title" content="AI WMS"/>
<meta property="og:image" content="https://sos.emiia.ai/vvjpg.jpg" />
<meta name="twitter:card" content="summary_large_image" />







<script src="https://telegram.org/js/telegram-web-app.js"></script>







<script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
<script src="/mapbox-gl.js" type="text/javascript"></script>


<link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">

<link href="/mapbox-gl.css" rel="stylesheet">


<style>
@import url('https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

	<style>
@import url('https://www.emiia.ru/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

  <style>  
@import url('/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

<link rel="stylesheet" href="https://www.emiia.ru/cssfamily=Montserrat.css">
<link rel="stylesheet" href="/cssfamily=Montserrat.css">



<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; background: #f8f9fa; }












</style>
</head>
<body>

<style type="text/css">
   
  }

</style>




<style>


.header {
    padding: 0rem;
    position: fixed;
    bottom: 50px;
    z-index: 20000;
    right: 5%;



}


@media (max-width: 768px) {
 .header {
    bottom: 0px; /* –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    right: 1%;

  }
}
</style>



<style type="text/css">
    
    
    
    a.mapboxgl-ctrl-logo{
    width: 0;
    height: 0;
    margin: 0 0 -4px-4px;
    display: block;
    background-repeat: no-repeat;
    cursor: pointer;
    overflow: hidden;
    background-image: url(data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='0.9' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E);
}



    
    
</style>


















<style type="text/css">
    
    
    
    a.mapboxgl-ctrl-logo{
    width: 0;
    height: 0;
    margin: 0 0 -4px-4px;
    display: block;
    background-repeat: no-repeat;
    cursor: pointer;
    overflow: hidden;
    background-image: url(data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='0.9' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E);
}





.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon {
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4wICg0MDM1YTRmYjQ5LCAyMDIwLTA1LTAxKSIKICAgc29kaXBvZGk6ZG9jbmFtZT0iY29tcGFzczMuMS5zdmciCiAgIGlkPSJzdmc0IgogICB2ZXJzaW9uPSIxLjEiCiAgIHN0eWxlPSJ0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTsiCiAgIHN0cm9rZS1saW5lam9pbj0icm91bmQiCiAgIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIKICAgc3Ryb2tlLXdpZHRoPSIwLjgiCiAgIHN0cm9rZT0iIzNkODVjNiIKICAgc3Ryb2tlLW9wYWNpdHk9IjAuOCIKICAgdmlld0JveD0iMCAwIDE2IDE2IgogICBmaWxsPSIjM2Q4NWM2IgogICBoZWlnaHQ9IjE4IgogICB3aWR0aD0iMTgiPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTEwIj4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZT48L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZGVmcwogICAgIGlkPSJkZWZzOCIgLz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIgogICAgIGlua3NjYXBlOndpbmRvdy15PSItMTEiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii0xMSIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDkzNTE3IgogICAgIGlua3NjYXBlOmN4PSItMTEuNzg1NTM5IgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MyIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaWQ9Im5hbWVkdmlldzYiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA0NiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIgLz4KICA8cGF0aAogICAgIGZpbGw9IiMzZDg1YzYiCiAgICAgc3Ryb2tlPSIjM2Q4NWM2IgogICAgIHN0cm9rZS13aWR0aD0iMC44IgogICAgIGlkPSJwYXRoMiIKICAgICBkPSJNIDguMDU0MTU0OSwyLjQ5MjE0OTIgQSAwLjUsMC40MDYxOTg2NyAwIDAgMSA4LjUyMTYwOSwyLjc1MjA0NTkgbCA1LjAzMDkyLDEwLjU1MTU4NDEgYSAwLjUsMC40MDYxOTg2NyAwIDAgMSAtMC42NTE4MzIsMC41MjQwMTUgTCA4LjA4Mjg0MzMsMTIuMjcxNTg4IDMuMjcyNzU5LDEzLjg0NjI4NSBBIDAuNSwwLjQwNjE5ODY3IDAgMCAxIDIuNjE5Mjc0OCwxMy4zMjQ3OTkgTCA3LjU4ODIzMDcsMi43NTM4NTMgQSAwLjUsMC40MDYxOTg2NyAwIDAgMSA4LjA1MzQ0OTQsMi40OTI3MjQ5IFogTSAzLjk2MTc4NzUsMTIuNzQ0ODc0IDcuODk0NDg2OCwxMS40NTc5NTIgYSAwLjUsMC40MDYxOTg2NyAwIDAgMSAwLjM3MTIzNywtMS4zOGUtNCBMIDEyLjIwNTkyMywxMi43Mjk0ODcgOC4wNTc5NTksNC4wMjk1MzIgWiIgLz4KPC9zdmc+);
    background-size: 25px 25px !important;
    background-position: 9.5px 8.5px !important;
    background-repeat: no-repeat !important;
}






.mapboxgl-ctrl-group button {
    width: 44px;
    height: 44px;
    display: block;
    padding: 0px;
    outline: none;
    border: 0;
    box-sizing: border-box;
    background-color: transparent;
    cursor: pointer;
    font: 13px / 20px Montserrat, montserrat;
    color: #ffffff7c;
}






.mapboxgl-ctrl-group {
    box-shadow: 0 0 10px 2px rgba(250, 0, 0, 0.0) !important;
}

.mapboxgl-ctrl-group {
    border-radius: 22px;
    background: transparent;
}





.mapboxgl-ctrl-top-left .mapboxgl-ctrl {
    margin: 1em !important;
}

/* –ú–æ–±–∏–ª—å–Ω—ã–µ */
@media (max-width: 767px) {
    .mapboxgl-ctrl-top-left .mapboxgl-ctrl {
        margin-left: 10px !important;
        margin-top: 33em !important;
    }
}

/* –ù–æ—É—Ç–±—É–∫–∏ –∏ –¥–µ—Å–∫—Ç–æ–ø—ã */
@media (min-width: 768px) {
    .mapboxgl-ctrl-top-left .mapboxgl-ctrl {
        margin-left: 18.5px !important;
        margin-top: 30em !important;
    }







#button778 {
    width: 41px;
    height: 43px;
    display: block;
    padding: 0px;
    outline: none;
    border: 0;
    box-sizing: border-box;
    background-color: transparent;
    cursor: pointer;
    font: 13px/20px Montserrat, montserrat;
    color: #383838;
    border-radius: 12px;
    
    
   border-bottom:0px 0px 1px 2px rgba(0, 0, 0, 0.1) !important;
   box-shadow: 0 0 10px 0.1px rgba(0, 0, 0, 0.1) !important;
   

.filter-blue {
    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4wICg0MDM1YTRmYjQ5LCAyMDIwLTA1LTAxKSIKICAgc29kaXBvZGk6ZG9jbmFtZT0iNzc4X3doaXRlLnN2ZyIKICAgdmVyc2lvbj0iMS4xIgogICB2aWV3Qm94PSIwIDAgMjUgMjUiCiAgIGhlaWdodD0iMjUiCiAgIHdpZHRoPSIyNSIKICAgZGF0YS1uYW1lPSJMYXllciAxIgogICBpZD0iTGF5ZXJfMSI+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMTMiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPtCX0L3QsNGH0LrQuCDRgNCw0LTQsNGAINC4INGC0L88L2RjOnRpdGxlPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZGVmcwogICAgIGlkPSJkZWZzMTEiIC8+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9IkxheWVyXzEiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iLTExIgogICAgIGlua3NjYXBlOndpbmRvdy14PSItMTEiCiAgICAgaW5rc2NhcGU6Y3k9IjE2LjUyNzY4NCIKICAgICBpbmtzY2FwZTpjeD0iMTUuOTk4OTY4IgogICAgIGlua3NjYXBlOnpvb209IjIyLjYyNzQxNyIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaWQ9Im5hbWVkdmlldzkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA0NiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIgLz4KICA8dGl0bGUKICAgICBpZD0idGl0bGUyIj7Ql9C90LDRh9C60Lgg0YDQsNC00LDRgCDQuCDRgtC/PC90aXRsZT4KICA8cGF0aAogICAgIGlkPSJwYXRoNCIKICAgICBzdHlsZT0iZmlsbDojMDA3OGZmO2ZpbGwtb3BhY2l0eToxIgogICAgIGQ9Ik0xOS4wNyw0LjA4QTEuMjQsMS4yNCwwLDAsMCwxNy44Niw0TDEwLjA3LDcuNzZhMS4yNSwxLjI1LDAsMCwwLS43MSwxLjEyVjExLjVMNCwxMy40YTEuMjQsMS4yNCwwLDAsMC0uODMsMS4xN1YyMGExLjI1LDEuMjUsMCwwLDAsMS4yNSwxLjI1SDE0LjY2bC0uMTItLjA4YTEuNzQsMS43NCwwLDAsMS0uNDgtMi4yLjQuNCwwLDAsMCwwLS4yMkgxMS44NlY5LjY3bDUuMjktMi41NXYzLjA2YTEuODIsMS44MiwwLDAsMSwuOTEuNzEuNDIuNDIsMCwwLDAsLjM0LjIuNC40LDAsMCwwLC4zMy0uMTgsMS42NiwxLjY2LDAsMCwxLC45Mi0uNzNWNS4xM0ExLjI1LDEuMjUsMCwwLDAsMTkuMDcsNC4wOFpNOS4zNiwxOC43OEg1LjY5VjE1LjQ1bDMuNjctMS4zMVoiIC8+CiAgPHBhdGgKICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2Nzc2MiCiAgICAgaWQ9InBhdGg2IgogICAgIHN0eWxlPSJmaWxsOiMwMDc4ZmY7ZmlsbC1vcGFjaXR5OjEiCiAgICAgZD0ibSAyMC4yMSwxMS4yOCBjIDAuMDc1OTUsLTAuMDE0ODMgMC4xNTQwNTEsLTAuMDE0ODMgMC4yMywwIDAuMzg4NTYxLDAuMTY3MTIzIDAuNzU0NzI4LDAuMzgyMTIgMS4wOSwwLjY0IDAuMjEzODUzLDAuMTcwNjgzIDAuMjczMDU0LDAuNDcwOTEyIDAuMTQsMC43MSAtMC41NzE4MzksMS4wMzg3NjggMC4xNDU0MjUsMi4zMTY4OTkgMS4zMywyLjM3IDAuMjY5NzE0LDAuMDA2MSAwLjQ5NjcxMiwwLjIwMzcxMiAwLjU0LDAuNDcgMC4wNTQ0OSwwLjQyODI3MyAwLjU0NDQ5LDAuODYxNzI3IDAsMS4yOSAtMC4wNDM4NiwwLjI2NDQzNCAtMC4yNzE5NTYsMC40NTg3MzkgLTAuNTQsMC40NiAtMS4xNTA3OCwwLjA2NzA1IC0xLjg2MDI5OSwxLjI4NjM3MyAtMS4zNSwyLjMyIDAuMTM2MjEsMC4yMzUzMDUgMC4wNzYyMywwLjUzNTE4MyAtMC4xNCwwLjcgLTAuMzQxMDI0LDAuMjYyNzM1IC0wLjcxNDAwMSwwLjQ4MTE0NSAtMS4xMSwwLjY1IC0wLjA2NjAxLDAuMDEzMiAtMC4xMzM5ODcsMC4wMTMyIC0wLjIsMCAtMC4xOTU3NDgsLTAuMDAxNiAtMC4zNzY5NzgsLTAuMTAzNTQ4IC0wLjQ4LC0wLjI3IC0wLjYzNjA3MywtMC45NjY3OCAtMi4wNTM5MjcsLTAuOTY2NzggLTIuNjksMCAtMC4xMDE5NjUsMC4xNjg4OTUgLTAuMjgyNzkyLDAuMjc0Mzc4IC0wLjQ4LDAuMjggLTAuMDY2MDEsMC4wMTMyIC0wLjEzMzk4NywwLjAxMzIgLTAuMiwwIC0wLjM5NTk5OSwtMC4xNjg4NTUgLTAuNzY4OTc2LC0wLjM4NzI2NSAtMS4xMSwtMC42NSAtMC4yMTYyMzQsLTAuMTY0ODE3IC0wLjI3NjIxLC0wLjQ2NDY5NSAtMC4xNCwtMC43IDAuMjU0MjI2LC0wLjQ3NDc3NyAwLjI1NDIyNiwtMS4wNDUyMjMgMCwtMS41MiAtMC4yNjkwOTcsLTAuNDc1MTExIC0wLjc2NDQzNCwtMC43Nzc2MDYgLTEuMzEsLTAuOCAtMC4yNjgwNDQsLTAuMDAxMyAtMC40OTYxNDEsLTAuMTk1NTY2IC0wLjU0LC0wLjQ2IC0wLjA0NjM2LC0wLjQyODc1IC0wLjA0NjM2LC0wLjg2MTI1IDAsLTEuMjkgMC4wNDMyOSwtMC4yNjYyODggMC4yNzAyODYsLTAuNDYzODYgMC41NCwtMC40NyAxLjE2Mzk3NSwtMC4wNDUzNCAxLjg4NTY5MiwtMS4yODU2MjcgMS4zNSwtMi4zMiAtMC4xMzc1MywtMC4yMzgzNjMgLTAuMDc3NzIsLTAuNTQxNjg2IDAuMTQsLTAuNzEgMC4zNDA1ODQsLTAuMjYwNzExIDAuNzEzNzM1LC0wLjQ3NTg2IDEuMTEsLTAuNjQgMC4wNjYwNiwtMC4wMTI2OSAwLjEzMzkzNywtMC4wMTI2OSAwLjIsMCAwLjE5NTc0OCwwLjAwMTYgMC4zNzY5NzgsMC4xMDM1NDggMC40OCwwLjI3IDAuNjI1NjUxLDEuMDA5NTMgMi4wOTQzNDksMS4wMDk1MyAyLjcyLDAgMC4wOTQwOSwtMC4xNTA3OTYgMC4yNDI0NzMsLTAuMzM4ODEyIDAuNDIsLTAuMzMgbSAtMS43OSw3IGMgMS44NDQzMDEsMCAyLjc2NzU5NywtMi4yMjk2NzcgMS40NjM2MzcsLTMuNTMzNjM3IEMgMTguNTc5Njc3LDEzLjQ0MjQwMyAxNi4zNSwxNC4zNjU2OTkgMTYuMzUsMTYuMjEgYyAwLDEuMTQzMjI5IDAuOTI2NzcxLDIuMDcgMi4wNywyLjA3IiAvPgo8L3N2Zz4K);
       
    background-size: 23px 23px !important;
    background-position: 8.5px 9px !important;
    background-repeat: no-repeat !important;
       
    position: fixed; 
    bottom: 2em; 
    right: 1.5em; 
    z-index: +200000;
}







.mapboxgl-ctrl-group button+button {
    border-top: 0.0px solid #ffffff7f;
    
    box-shadow: 0 0 5px 0.5px rgba(0, 0, 0, 0.1) !important;
}




.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl {
    float: right;
    margin: 0 18px 25px 0;
}
    
    
</style>

























<script>
!function e(t,o,r){function i(s,a){if(!o[s]){if(!t[s])


{var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(n)return n(s,!0);var p=new Error("Cannot find module '"+s+"'");



throw p.code="MODULE_NOT_FOUND",p}var c=o[s]={exports:{}};t[s][0].call(c.exports,function(e){var o=t[s][1][e];return i(o||e)},c,c.exports,e,t,o,r)}return o[s].exports}for(var n="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,o){function r(e,t){if(!(this instanceof r))


throw new Error("MapboxMarkers needs to be called with the new keyword");this.URLSearchParams=new URLSearchParams(new URL(window.location).search),this._sourceName="markerspec",this._geojson=e,this._rendered=!1,this.options=Object.assign(




{disabled:this.URLSearchParams.get("disabled")||!0,showControl:this.URLSearchParams.get("show-control")||!0,marker:{image:""},



popup:{description:"<i></i>"},style:{label:"{name}",labelSize:10,color:this.URLSearchParams.get("style-color")||"transporent",size:2,opacity:1,icon:"marker",layers:null}},t),this.toggle=this.toggle.bind(this),this.render=this.render.bind(this),this._toggleLayers=this._toggleLayers.bind(this),this._updateMap=this._updateMap.bind(this),this._toggle=new i({show:this.options.showControl,onToggle:this.toggle.bind(this)})}function i(e){var t,o;e=Object.assign({show:!0,onToggle:function(){}},e),this._btn=((t=document.createElement("button")).className="mapboxgl-ctrl-icon mapboxgl-ctrl-markers",t.type="button",t["aria-label"]="Inspect",t),this._btn.onclick=e.onToggle,this._input=((o=document.createElement("input")).id="marker-search",o.type="text",o.placeholder="Marker Search",o.style.display="none",o),this.elem=function(e,t,o){var r=document.createElement("div");return r.className="mapboxgl-ctrl mapboxgl-ctrl-group markerspec",r.appendChild(e),o||(r.style.display="none"),r}(this._btn,this._input,e.show)}r.prototype.onAdd=function(e){return this._map=e,e.on("load",this.render),e.on("moveend",this._updateMap),this._toggle.elem},r.prototype.onRemove=function(){this._map.off("load",this.render);var e=this._toggle.elem;e.parentNode.removeChild(e),this._map=void 0},r.prototype.toggle=function(){this.options.enabled=!this.options.enabled,this.render()},r.prototype.render=function(){if(!this._rendered){var e=this;if(this.URLSearchParams.get("data")){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(e._geojson=JSON.parse(t.responseText),o())},t.open("GET",this.URLSearchParams.get("data"),!0),t.send(null)}else o();function o(){e._geojson.features.forEach(function(t){if("Point"==t.geometry.type){var o=document.createElement("div");


o.className="markerspec marker",o.style=`background-image:url('${t.properties["marker-image"]||e.options.marker.image}')`,o.onclick=function(e){map.flyTo({center:t.geometry.coordinates})};var r=(void 0!==t.properties.title?`<h3>${t.properties.title}</h3>`:"")+(void 0!==t.properties.image?`<img src='${t.properties.image}' width=200 alt='${t.properties.title}'>`:"")+(void 0!==t.properties.description?`<p>${t.properties.description}</p>`:`<p>${e.options.popup.description}</p>`)+(void 0!==t.properties.website?`<a href='${t.properties.website}' target='_blank' class='button'>Website</a>`:`<a href='https://www.openstreetmap.org/?mlat=${t.geometry.coordinates[1]}&mlon=${t.geometry.coordinates[0]}' target='_blank' class='button'></a>`);


new mapboxgl.Marker(o).setLngLat(t.geometry.coordinates).setPopup(new mapboxgl.Popup({offset:25}).setHTML(r)).addTo(map)}}),e._map.addSource("markerspec",{type:"geojson",data:e._geojson});var t,o,r=e._map.getStyle().layers.filter(function(e){return"building"===e["source-layer"]}),i=r[r.length-1].id;e.options.style.layers||(e.options.style.layers=(t=e._sourceName,o=e.options.style,[{id:`${t} fill`,type:"fill",source:`${t}`,paint:{"fill-color":o.color,"fill-opacity":o.opacity},filter:["==","$type","Polygon"]},{id:`${t} line`,type:"line",source:`${t}`,paint:{"line-color":o.color,"line-width":o.size,"line-opacity":o.opacity}},{id:`${t} circle`,type:"circle",source:`${t}`,paint:{"circle-color":o.color,"circle-radius":o.size,"circle-opacity":o.opacity}},{id:`${t} symbol`,type:"symbol",source:`${t}`,





layout:{"text-field":o.label,"text-size":o.labelSize,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-anchor":"top","icon-image":"{icon}-25","road-label-navigation":!0}}]));var n=function(e,t,o){for(var r=0;r<e.layers.length;r++)






{var i=e.layers[r];if(o===i.id){var n=e.layers.slice(0,r).concat(t).concat(e.layers.slice(r));return Object.assign({},e,{layers:n})}}return e}(e._map.getStyle(),e.options.style.layers,i);e._map.setStyle(n),e._toggle._input.onkeypress=(t=>{if("Enter"===t.key)return e.options.query=e._toggle._input.value,e._updateMap(),!0})}this._rendered=!0}this.options.enabled?(this._toggleLayers(),this._toggle.setMapIcon()):(this._toggleLayers(),this._toggle.setPluginIcon())},r.prototype._updateMap=function(){this.options.enabled&&this.options._geojson&&console.log("Nothing to update")},i.prototype.setPluginIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-markers"},i.prototype.setMapIcon=function(){this._btn.className="mapboxgl-ctrl-icon mapboxgl-ctrl-map"},r.prototype._toggleLayers=function(){var e=this.options.enabled;Array.from(document.getElementsByClassName("markerspec marker")).forEach(function(t){t.style.display=e?"inline":"none"});var t=new RegExp(this._sourceName),o=this._map.getStyle();o.layers.forEach(function(o){t.test(o.source)&&(o.layout=o.layout||{},o.layout.visibility=e?"visible":"none")}),this._map.setStyle(o),this._toggle._input.style.display=e?"inline":"none"},void 0!==t&&void 0!==t.exports?window.MapboxMarkers=r:t.exports=r},{}]},{},[1]); 




</script>



















 










<style>


.calculation-box {
   height: 30px;
    width: 300px;
    position: absolute;
    bottom: 110px !important;
    left: 18px;
    background-color: transparent;
    padding: 19.5px;
    font-family: 'Montserrat', montserrat !important; 
}




 
p {
font-family: 'Montserrat';
margin: 0px;
font-size: 10px;
color: #3d85c6;




}

.calculation-box p:not(:last-child) {
    margin-bottom: 10px; /* –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º <p>, –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ */





}

.highlight {
    font-size: 18px; /* –£–≤–µ–ª–∏—á—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, 18px */
font-weight: 500; /* –ñ–∏—Ä–Ω–æ—Å—Ç—å (700 = bold, 800 –∏–ª–∏ 900 ‚Äî –µ—â—ë –∂–∏—Ä–Ω–µ–µ) */




}

.highlight1 {
    position: relative;
    top: 3px; /* –û–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–µ–ª–∫—É –Ω–∞ 3px –≤–Ω–∏–∑, –∏–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
font-size: 18px; /* –£–≤–µ–ª–∏—á—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, 18px */






}

</style>










<style>




.marker {
        background-image: url('https://sos.emiia.ai/vv_g_m_STORE_21_90EE90.svg');
        background-size: cover;
  width: 80px;
  height: 80px;
  border-radius: 0%;
  cursor: pointer;
      }
      .mapboxgl-popup {
        max-width: 200px;

      }
      .mapboxgl-popup-content {
        text-align: left;
        font-family: 'Montserrat', montserrat !important; 
        border-radius: 20px;
        background-color: #f8f9fa;
      }




:root {
  --popup-bg-color: #f8f9fa;
  --popup-text-color: #3d85c6;
  --close-button-color: #3d85c6;
  --close-button-hover-color: #383838;
  --close-button-bg-hover: rgba(0, 0, 0, 0.1);
}

.marker1 {
  background-image: url('https://sos.emiia.ai/vv_g_m_DARKSTORE_33_90EE90.svg');
  background-size: cover;
  width: 80px;
  height: 80px;
  border-radius: 0%;
  cursor: pointer;
}

.mapboxgl-popup {
  max-width: 290px;
}

.mapboxgl-popup-content {
  text-align: left;
  font-family: 'Montserrat', montserrat !important; 
  border-radius: 20px;
  background-color: var(--popup-bg-color);
  color: var(--popup-text-color);
  padding: 15px;
}

/* –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ —Ö–≤–æ—Å—Ç–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–æ–∂–µ–Ω–∏–π */
.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-bottom-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {
  border-bottom-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
  border-bottom-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {
  border-top-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  border-top-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-right-color: var(--popup-bg-color) !important;
}

.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-left-color: var(--popup-bg-color) !important;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è (–∫—Ä–µ—Å—Ç–∏–∫–∞) */
.mapboxgl-popup-close-button {
  color: var(--close-button-color);
  font-size: 18px;
  padding: 8px;
  margin: 2px;
  border: none;
  background: none;
  border-radius: 10px;
}

.mapboxgl-popup-close-button:hover {
  background-color: var(--close-button-bg-hover);
  color: var(--close-button-hover-color);
}

.mapboxgl-popup-close-button:focus {
  outline: none;
  box-shadow: none;
}






/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è (–∫—Ä–µ—Å—Ç–∏–∫–∞) */
.mapboxgl-popup-close-button {
  color: var(--close-button-color);
  font-size: 24px; /* –£–≤–µ–ª–∏—á–∏–ª —Å 18px –¥–æ 24px */
  padding: 12px; /* –£–≤–µ–ª–∏—á–∏–ª —Å 8px –¥–æ 12px */
  margin: 4px; /* –£–≤–µ–ª–∏—á–∏–ª —Å 2px –¥–æ 4px */
  border: none;
  background: none;
  border-radius: 12px; /* –£–≤–µ–ª–∏—á–∏–ª —Å 10px –¥–æ 12px */
  width: 40px; /* –î–æ–±–∞–≤–∏–ª —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É */
  height: 40px; /* –î–æ–±–∞–≤–∏–ª —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É */
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

/* –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width: 768px) {
  .mapboxgl-popup-close-button {
    font-size: 28px; /* –ï—â–µ –±–æ–ª—å—à–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    padding: 14px;
    margin: 6px;
    width: 44px;
    height: 44px;
  }
}

/* –•–æ–≤–µ—Ä-—ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –ª—É—á—à–µ–π UX */
.mapboxgl-popup-close-button:hover {
  background: rgba(0, 0, 0, 0.1);
  transform: scale(1.1);
}

.mapboxgl-popup-close-button:active {
  transform: scale(0.95);
}




</style>















<style>
/* –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ç–æ–Ω–∫–∏–µ –Ω–∞—á–µ—Ä—Ç–∞–Ω–∏—è Montserrat */
@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap');

/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è popup */
.mapboxgl-popup {
    max-width: 250px !important;
    min-width: 250px !important;
    border-radius: 15px;
    font-family: 'Montserrat', sans-serif !important;
    z-index: 10000 !important;
}

.mapboxgl-popup-content {
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    padding: 15px;
    max-width: 250px !important;
    min-width: 250px !important;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    width: 250px !important; /* –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É */
}

.iss-data {
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    margin-top: 12px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 0px solid #3d85c6;
    max-width: 100%;
    z-index: 10000 !important;
}

.data-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
    margin: 10px 0;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    z-index: 10000 !important;
}

.data-item {
    padding: 5px 6px;
    background: #f8f9fa;
    border-radius: 10px;
    font-size: 11px;
    border: 1px solid #3d85c6;
    line-height: 1.3;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    z-index: 10000 !important;
}

.data-item strong {
    color: #3d85c6;
    font-size: 10px;
    display: block;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 500;
}

.update-info {
    font-size: 9px;
    color: #3d85c6;
    text-align: center;
    margin-top: 10px;
    padding: 6px;
    background: #f8f9fa;
    border-radius: 15px;
    border: 1px dashed #3d85c6;
    line-height: 1.2;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

.loading {
    text-align: center;
    color: #3d85c6;
    font-style: italic;
    padding: 15px;
    font-size: 11px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

.error {
    color: #3d85c6;
    text-align: center;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 10px;
    font-size: 11px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
    border: 1px solid #3d85c6;
}

.popup-content {
    max-width: 100%;
    border-radius: 15px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

.popup-content h3 {
    font-size: 14px;
    margin: 0 0 8px 0;
    color: #3d85c6;
    line-height: 1.2;
    border-radius: 15px;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 500;
}

.popup-content p {
    font-size: 11px;
    margin: 0 0 10px 0;
    line-height: 1.3;
    color: #3d85c6;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è */
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

.updating {
    animation: pulse 2s infinite;
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–æ–Ω–∫–∏—Ö —à—Ä–∏—Ñ—Ç–æ–≤ */
.mapboxgl-popup-close-button {
    font-family: 'Montserrat', sans-serif !important;
    font-weight: 300;
}

/* –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–æ–Ω–∫–∏—Ö —à—Ä–∏—Ñ—Ç–æ–≤ */
.data-item, .update-info, .loading, .error {
    letter-spacing: 0.02em;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è popup –ø–æ–≤–µ—Ä—Ö –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.top-popup {
    z-index: 10000 !important;
}

.mapboxgl-popup.top-popup {
    z-index: 10000 !important;
}

.mapboxgl-popup-content.top-popup {
    z-index: 10001 !important;
}

/* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
@media (max-width: 768px) {
    .mapboxgl-popup {
        max-width: 250px !important;
        min-width: 250px !important;
        width: 250px !important;
    }
    
    .mapboxgl-popup-content {
        max-width: 250px !important;
        min-width: 250px !important;
        width: 250px !important;
    }
}












/* –î–µ–ª–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫—É –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é popup */
.mapboxgl-popup-tip {
    z-index: 10010 !important;
    pointer-events: none !important; /* –ß—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–∞ –∫–ª–∏–∫–∞–º */
}

/* –ò–ª–∏ —Å–∫—Ä—ã—Ç—å –º–∞—Ä–∫–µ—Ä—ã –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç popup */
.mapboxgl-popup:not(.mapboxgl-popup-hover) ~ .mapboxgl-marker {
    opacity: 0.7 !important; /* –ó–∞—Ç–µ–º–Ω–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã –ø–æ–¥ popup */
}





</style>
















<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ù–∞—Ö–æ–¥–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É –∏ –µ—ë –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const emiiaButton = document.getElementById('emiiaButton');
        const emiiaMenu = document.getElementById('emiiaMenu');
        const originalContainer = emiiaButton.parentElement;

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–≤—É—Ö –∫–Ω–æ–ø–æ–∫
        const newContainer = document.createElement('div');
        newContainer.style.cssText = originalContainer.style.cssText;
        newContainer.className = originalContainer.className;
        newContainer.style.display = 'flex';
        newContainer.style.alignItems = 'center';
        newContainer.style.gap = '15px';
        newContainer.style.padding = '7.5px 10px';

        // –ö–Ω–æ–ø–∫–∞ 1: –¢–æ—á–∫–∏ (–ª–µ–≤–∞—è)
        const dotsButton = document.createElement('button');
        dotsButton.id = 'dotsButton';
        dotsButton.innerHTML = '‚ãÆ';
        dotsButton.style.cssText = `
            background: transparent;
            color: #f8f9fa;
            border: none;
            font-size: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0px;
            height: 19px;
            line-height: 0;
            position: relative;
            top: -0.1px;
            text-shadow: 0 0 1px white, 0 0 10px white, 0 0 1px white;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        `;

        // –ö–Ω–æ–ø–∫–∞ 2: –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é (–ø—Ä–∞–≤–∞—è)
        const mainButton = emiiaButton.cloneNode(true);
        mainButton.id = 'mainButton';
        mainButton.style.margin = '0';

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        newContainer.appendChild(dotsButton);
        newContainer.appendChild(mainButton);
        
        // –ó–∞–º–µ–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        originalContainer.parentNode.replaceChild(newContainer, originalContainer);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ–±–Ω—É–ª–µ–Ω–∏—è –±–µ–π–¥–∂–∞)
function resetNotifications() {
    console.log('üîÑ –°–±—Ä–æ—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
    
    // –°–±—Ä–æ—Å –±–µ–π–¥–∂–∞ –≤ PWA
    if ('setAppBadge' in navigator) {
        navigator.setAppBadge(0).then(() => {
            console.log('‚úÖ –ë–µ–π–¥–∂ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–±–Ω—É–ª–µ–Ω');
        }).catch(error => {
            console.log('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –±–µ–π–¥–∂–∞:', error);
        });
    }
    
    // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –≤ localStorage
    try {
        const savedState = localStorage.getItem('fixedIOSNotificationState');
        if (savedState) {
            const state = JSON.parse(savedState);
            state.badgeCount = 0;
            state.notificationCounter = 0;
            localStorage.setItem('fixedIOSNotificationState', JSON.stringify(state));
            console.log('‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–±—Ä–æ—à–µ–Ω–æ –≤ localStorage');
        }
        
        // –¢–∞–∫–∂–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–±—â–∏–π —Å—á–µ—Ç—á–∏–∫
        localStorage.setItem('notificationBadgeCount', '0');
    } catch (error) {
        console.log('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:', error);
    }
    
    // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.ready.then(registration => {
            registration.getNotifications().then(notifications => {
                notifications.forEach(notification => {
                    notification.close();
                });
                console.log(`‚úÖ –ó–∞–∫—Ä—ã—Ç–æ ${notifications.length} –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`);
            });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Service Worker –¥–ª—è —Å–±—Ä–æ—Å–∞ –±–µ–π–¥–∂–∞
            registration.active.postMessage({
                type: 'CLEAR_BADGE'
            });
        });
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ navigator.serviceWorker.controller
    if (navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage({
            type: 'CLEAR_BADGE'
        });
    }
}

        // –°–æ–∑–¥–∞–µ–º –º–µ–Ω—é —Ç–æ—á–µ–∫ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ –ø–æ–¥–º–µ–Ω—é
        const dotsMenu = document.createElement('div');
        dotsMenu.id = 'dotsMenu';
        dotsMenu.style.cssText = `
            display: none;
            position: fixed;
            background: rgba(204, 204, 204, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 18px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 8px 0;
            z-index: 10000;
            max-width: 280px;
            max-height: 70vh;
            overflow-y: auto;
            opacity: 0;
            transform: translateY(10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: bottom left;
            -webkit-overflow-scrolling: touch;
        `;
        
        dotsMenu.innerHTML = `
            <div class="menu-item-with-icon" data-action="settings">
<svg xmlns="http://www.w3.org/2000/svg " width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
  <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
  <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
</svg>
                <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>

            <div class="menu-divider"></div>
            <div class="menu-item-with-icon" data-action="refresh">
                <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" viewBox="0 0 16 16">
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                </svg>
                <span>–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
            </div>



     <div class="menu-divider"></div>
            <div class="menu-item-with-icon" data-action="reset">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308c-.12.1-.12.284 0 .384l2.36 1.966a.25.25 0 0 0 .41-.192z"/>
                </svg>
                <span>–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</span>
            </div>

            <div class="menu-divider"></div>
            <div class="menu-item-with-icon" data-action="messages">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-square-dots" viewBox="0 0 16 16">
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1h-2.5a2 2 0 0 0-1.6.8L8 14.333 6.1 11.8a2 2 0 0 0-1.6-.8H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5a1 1 0 0 1 .8.4l1.9 2.533a1 1 0 0 0 1.6 0l1.9-2.533a1 1 0 0 1 .8-.4H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                    <path d="M5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                </svg>
                <span>–°–æ–æ–±—â–µ–Ω–∏—è</span>
            </div>



            <div class="menu-divider"></div>
            <div class="menu-item-with-icon" data-action="z1">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-spreadsheet" viewBox="0 0 16 16">
  <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v4h10V2a1 1 0 0 0-1-1zm9 6h-3v2h3zm0 3h-3v2h3zm0 3h-3v2h2a1 1 0 0 0 1-1zm-4 2v-2H6v2zm-4 0v-2H3v1a1 1 0 0 0 1 1zm-2-3h2v-2H3zm0-3h2V7H3zm3-2v2h3V7zm3 3H6v2h3z"/>
</svg>
                <span>ERP</span>
            </div>

            <div class="menu-divider"></div>
            <div class="menu-item-with-icon" data-action="z1">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
  <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
</svg>
                <span>CRM, –≠–î–û...</span>
            </div>

            <div class="menu-divider"></div>
            
            <!-- –ü–£–ù–ö–¢ –° –ü–û–î–ú–ï–ù–Æ 1 -->
            <div class="menu-item-with-icon submenu-parent" data-action="navi">
                <svg xmlns="http://www.w3.org/2000/svg " width="28" height="28" fill="currentColor" class="bi bi-cloud" viewBox="0 0 16 16">
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383m.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
                </svg>
                <span>–ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –º–æ–¥—É–ª–∏ EMIIA.AI SIP</span>
                <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" fill="currentColor" viewBox="0 0 17 17">
                    <path stroke="currentColor" stroke-width="0.8" fill="currentColor" fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                </svg>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-action="open-url" data-url="https://sos.emiia.ai/vv3.html " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ò–ò-–∞–≥–µ–Ω—Ç EMIIA.AI TAI</span>
                </div>
                <div class="submenu-item" data-action="open-url" data-url="https://emiia.ai " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ò–ò-–∞–≥–µ–Ω—Ç EMIIA.AI OAI</span>
                </div>
            </div>
            <div class="menu-divider"></div>
            
            <!-- –ü–£–ù–ö–¢ –° –ü–û–î–ú–ï–ù–Æ 2: –ü–ê–ö EMIIA.AI LEM/IOT -->
            <div class="menu-item-with-icon submenu-parent" data-action="lem-iot">
<svg xmlns="http://www.w3.org/2000/svg " width="16" height="16" fill="currentColor" class="bi bi-cpu" viewBox="0 0 16 16">
  <path d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0m-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/>
</svg>

                <span>–ü–ê–ö <br>EMIIA.AI LEM/IOT</span>
                <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" fill="currentColor" viewBox="0 0 17 17">
                    <path stroke="currentColor" stroke-width="0.8" fill="currentColor" fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                </svg>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-action="open-url" data-url="https://emiia.ai/lem " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –ö–ª–∞—Å—Ç–µ—Ä—ã EMIIA.AI LEM</span>
                </div>
                <div class="submenu-item" data-action="open-url" data-url="https://emiia.ai/iot " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –®–ª—é–∑—ã EMIIA.AI IOT</span>
                </div>
            </div>
            <div class="menu-divider"></div>
            
            <!-- –ü–£–ù–ö–¢ –° –ü–û–î–ú–ï–ù–Æ 3: –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–¥–∞—Ç–∞—Å–µ—Ç—ã) -->
            <div class="menu-item-with-icon submenu-parent" data-action="ml-datasets">
                <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" viewBox="0 0 16 16">
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM4.151 15.29a1.2 1.2 0 0 1-.111-.449h.764a.58.58 0 0 0 .255.384q.105.073.25.114.142.041.319.041.245 0 .413-.07a.56.56 0 0 0 .255-.193.5.5 0 0 0 .084-.29.39.39 0 0 0-.152-.326q-.152-.12-.463-.193l-.618-.143a1.7 1.7 0 0 1-.539-.214 1 1 0 0 1-.352-.367 1.1 1.3 0 0 1-.123-.524q0-.366.19-.639.192-.272.528-.422.337-.15.777-.149.456 0 .779.152.326.153.5.41.18.255.2.566h-.75a.56.56 0 0 0-.12-.258.6.6 0 0 0-.246-.181.9.9 0 0 0-.37-.068q-.324 0-.512.152a.47.47 0 0 0-.185.384q0 .18.144.3a1 1 0 0 0 .404.175l.621.143q.326.075.566.211a1 1 0 0 1 .375.358q.135.222.135.56 0 .37-.188.656a1.2 1.2 0 0 1-.539.439q-.351.158-.858.158-.381 0-.665-.09a1.4 1.4 0 0 1-.478-.252 1.1 1.1 0 0 1-.29-.375m-3.104-.033a1.3 1.3 0 0 1-.082-.466h.764a.6.6 0 0 0 .074.27.5.5 0 0 0 .454.246q.285 0 .422-.164.137-.165.137-.466v-2.745h.791v2.725q0 .66-.357 1.005-.355.345-.985.345a1.6 1.6 0 0 1-.568-.094 1.15 1.15 0 0 1-.407-.266 1.1 1.1 0 0 1-.243-.39m9.091-1.585v.522q0 .384-.117.641a.86.86 0 0 1-.322.387.9.9 0 0 1-.47.126.9.9 0 0 1-.47-.126.87.87 0 0 1-.32-.387 1.55 1.55 0 0 1-.117-.641v-.522q0-.386.117-.641a.87.87 0 0 1 .32-.387.87.87 0 0 1 .47-.129q.265 0 .47.129a.86.86 0 0 1 .322.387q.117.255.117.641m.803.519v-.513q0-.565-.205-.973a1.46 1.46 0 0 0-.59-.63q-.38-.22-.916-.22-.534 0-.92.22a1.44 1.44 0 0 0-.589.628q-.205.407-.205.975v.513q0 .562.205.973.205.407.589.626.386.217.92.217.536 0 .917-.217.384-.22.589-.626.204-.41.205-.973m1.29-.935v2.675h-.746v-3.999h.662l1.752 2.66h.032v-2.66h.75v4h-.656l-1.761-2.676z"/>
                </svg>
                <span>–ú–∞—à–∏–Ω–Ω–æ–µ <br>–æ–±—É—á–µ–Ω–∏–µ (–¥–∞—Ç–∞—Å–µ—Ç—ã)</span>
                <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" fill="currentColor" viewBox="0 0 17 17">
                    <path stroke="currentColor" stroke-width="0.8" fill="currentColor" fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
                </svg>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-action="open-url" data-url="https://emiia.ai/datasets " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –ì—É–º–∞–Ω–æ–∏–¥–Ω—ã–µ —Ä–æ–±–æ—Ç—ã</span>
                </div>
                <div class="submenu-item" data-action="open-url" data-url="https://emiia.ai/models " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ —Ä–æ–±–æ—Ç—ã</span>
                </div>
                <div class="submenu-item" data-action="open-url" data-url="https://emiia.ai/service-robots " data-target="_self">
                    <span><span style="font-weight: bold;"> ‚Ä¢</span> –°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ä–æ–±–æ—Ç—ã</span>
                </div>
            </div>
            <div class="menu-divider"></div>
            
            <div class="menu-item-with-icon" data-action="terms">
                <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" viewBox="0 0 16 16">
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                </svg>
                <span>–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</span>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-item-with-icon" data-action="privacy">
                <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg " width="16" height="16" viewBox="0 0 16 16">



                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .101.025 1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43A63 63 0 0 1 5.072.56"/>
                    <path stroke="#f8f9fa" stroke-width="0.5" fill="#f8f9fa" d="M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0"/>
                </svg>
                <span>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</span>
            </div>
        `;
        document.body.appendChild(dotsMenu);

        // –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
        const dotsOverlay = document.createElement('div');
        dotsOverlay.id = 'dotsOverlay';
        dotsOverlay.style.cssText = `
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.00);
            z-index: 9998;
            pointer-events: auto;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        `;
        document.body.appendChild(dotsOverlay);

        // –°–¢–ò–õ–ò
        const style = document.createElement('style');
        style.textContent = `
            .menu-item-with-icon {
                padding: 10px 16px;
                cursor: pointer;
                border-radius: 5px;
                transition: all 0.2s ease;
                color: #f8fafa;
                display: flex;
                align-items: center;
                gap: 10px;
                font-family: 'Montserrat', sans-serif;
                font-size: 16px;
                font-weight: 500;
                opacity: 0;
                transform: translateX(-10px);
                animation: menuItemAppear 0.4s ease forwards;
            }
            .menu-item-with-icon:nth-child(1) { animation-delay: 0.05s; }
            .menu-item-with-icon:nth-child(3) { animation-delay: 0.1s; }
            .menu-item-with-icon:nth-child(5) { animation-delay: 0.15s; }
            .menu-item-with-icon:nth-child(7) { animation-delay: 0.2s; }
            .menu-item-with-icon:nth-child(9) { animation-delay: 0.25s; }
            .menu-item-with-icon:nth-child(11) { animation-delay: 0.3s; }
            .menu-item-with-icon:nth-child(13) { animation-delay: 0.35s; }
            .menu-item-with-icon:nth-child(15) { animation-delay: 0.4s; }
            .menu-item-with-icon:nth-child(17) { animation-delay: 0.45s; }
            
            .menu-item-with-icon:hover {
                background: #cccccc69;
                transform: translateX(0);
            }
            
            .menu-divider {
                height: 1px;
                background-color: #F8F8F8;
                margin: 4px 12px;
            }
            
            .menu-icon {
                width: 16px;
                height: 16px;
                flex-shrink: 0;
            }
            
            .submenu-parent .arrow-icon {
                width: 16px;
                height: 16px;
                fill: #f8f9fa;
                flex-shrink: 0;
                margin-left: auto;
                transform: rotate(180deg);
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .submenu-parent.active .arrow-icon {
                transform: rotate(0deg);
            }
            
            #mainButton .arrow-icon {
                width: 16px;
                height: 16px;
                fill: #f8f9fa;
                flex-shrink: 0;
                margin-left: 8px;
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            #mainButton.active .arrow-icon {
                transform: rotate(180deg);
            }
            
            .submenu {
                background: rgba(204, 204, 204, 0.5);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border-radius: 12px;
                padding: 0;
                margin: 4px 16px 8px 26px;
                overflow: hidden;
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                max-height: 0;
                opacity: 0;
            }
            
            .submenu.active {
                max-height: 150px;
                opacity: 1;
                padding: 6px 0;
            }
            
            .submenu-item {
                padding: 8px 16px 8px 5px;
                font-size: 16px;
                font-weight: 500;
                opacity: 0;
                transform: translateX(-10px);
                transition: all 0.3s ease;
                cursor: pointer;
                border-radius: 8px;
                color: #f8f9fa;
                font-family: 'Montserrat', sans-serif;
            }
            
            .submenu.active .submenu-item {
                opacity: 1;
                transform: translateX(0);
            }
            
            .submenu.active .submenu-item:nth-child(1) {
                transition-delay: 0.1s;
            }
            
            .submenu.active .submenu-item:nth-child(2) {
                transition-delay: 0.15s;
            }

            .submenu.active .submenu-item:nth-child(3) {
                transition-delay: 0.2s;
            }
            
            .submenu-item:hover {
                background: #cccccc69;
            }
            
            /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è WebKit –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
            #dotsMenu::-webkit-scrollbar {
                width: 6px;
            }
            
            #dotsMenu::-webkit-scrollbar-track {
                background: rgba(204, 204, 204, 0.2);
                border-radius: 10px;
                margin: 8px 0;
            }
            
            #dotsMenu::-webkit-scrollbar-thumb {
                background: rgba(248, 249, 250, 0.5);
                border-radius: 10px;
            }
            
            #dotsMenu::-webkit-scrollbar-thumb:hover {
                background: rgba(248, 249, 250, 0.7);
            }
            
            @keyframes menuItemAppear {
                from {
                    opacity: 0;
                    transform: translateX(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);

        



// –õ–û–ì–ò–ö–ê
function handleAction(action, url = null, target = '_self') {
    switch(action) {
        case 'settings':
            window.location.href = 'https://emiia.ai';
            break;
        case 'terms':
            window.location.href = 'https://emiia.ai/terms';
            break;
        case 'reset':
            // –°–±—Ä–æ—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            resetNotifications();
            console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã');
            break;
        case 'messages':
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ SVG ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º
            console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ SVG...');
            break;
        case 'z1':
            window.location.href = 'https://sos.emiia.ai/wifi/wifi';
            break;
        case 'privacy':
            window.location.href = 'https://emiia.ai/privacy';
            break;
        case 'refresh':
            location.reload();
            break;
        case 'lem-iot':
        case 'ml-datasets':
            break;
        case 'open-url':
            if (url) {
                window.location.href = url;
            }
            break;
    }
}






        function toggleMainMenu() {
            const isActive = emiiaMenu.classList.contains('active');
            if (isActive) {
                emiiaMenu.classList.remove('active');
                mainButton.classList.remove('active');
            } else {
                emiiaMenu.classList.add('active');
                mainButton.classList.add('active');
                closeDotsMenu();
            }
        }

        mainButton.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleMainMenu();
        });

        let dotsMenuJustOpened = false;
        let dotsMenuTimeout = null;

        function toggleDotsMenu() {
            const isVisible = dotsMenu.style.display === 'block';
            if (isVisible) {
                closeDotsMenu();
            } else {
                openDotsMenu();
            }
        }

        function openDotsMenu() {
            const containerRect = newContainer.getBoundingClientRect();
            const scrollY = window.scrollY;
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;
            const menuMaxHeight = viewportHeight * 0.7; // 70vh
            
            dotsMenu.style.maxHeight = menuMaxHeight + 'px';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ —Å–≤–µ—Ä—Ö—É (–¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–≤–µ—Ä—Ö)
            const spaceAbove = containerRect.top;
            const spaceBelow = viewportHeight - containerRect.bottom;
            
            // –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤–≤–µ—Ä—Ö, –µ—Å–ª–∏ —Ç–∞–º –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –∏–ª–∏ –µ—Å–ª–∏ —Å–Ω–∏–∑—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
            if (spaceAbove > spaceBelow || spaceBelow < 150) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–≤–µ—Ä—Ö (—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
                dotsMenu.style.bottom = (viewportHeight - containerRect.top + 10) + 'px';
                dotsMenu.style.top = 'auto';
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º, –µ—Å–ª–∏ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≤–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π
                if (spaceAbove > menuMaxHeight + 20) {
                    dotsMenu.style.maxHeight = Math.min(menuMaxHeight, spaceAbove - 20) + 'px';
                }
            } else {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–Ω–∏–∑ (—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)
                dotsMenu.style.top = (containerRect.bottom + 10) + 'px';
                dotsMenu.style.bottom = 'auto';
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º, –µ—Å–ª–∏ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –Ω–∏–∂–Ω–∏–π –∫—Ä–∞–π
                if (spaceBelow > menuMaxHeight + 20) {
                    dotsMenu.style.maxHeight = Math.min(menuMaxHeight, spaceBelow - 20) + 'px';
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –º–µ–Ω—é –∑–∞ –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞
            let left = containerRect.left;
            if (left + 280 > viewportWidth) {
                left = viewportWidth - 290; // 280px —à–∏—Ä–∏–Ω–∞ + 10px –æ—Ç—Å—Ç—É–ø
            }
            dotsMenu.style.left = left + 'px';
            
            dotsMenu.style.display = 'block';
            dotsOverlay.style.display = 'block';
            
            void dotsMenu.offsetHeight;
            
            setTimeout(() => {
                dotsMenu.style.opacity = '1';
                dotsMenu.style.transform = 'translateY(0) scale(1)';
                dotsOverlay.style.opacity = '1';
            }, 50);
            
            dotsMenuJustOpened = true;
            if (dotsMenuTimeout) clearTimeout(dotsMenuTimeout);
            dotsMenuTimeout = setTimeout(() => {
                dotsMenuJustOpened = false;
            }, 500);
        }

        function closeDotsMenu() {
            const menuItems = dotsMenu.querySelectorAll('.menu-item-with-icon');
            menuItems.forEach(item => {
                item.style.animation = 'none';
            });
            
            // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–¥–º–µ–Ω—é
            const allSubmenuParents = dotsMenu.querySelectorAll('.submenu-parent');
            const allSubmenus = dotsMenu.querySelectorAll('.submenu');
            
            allSubmenuParents.forEach(parent => {
                parent.classList.remove('active');
            });
            
            allSubmenus.forEach(submenu => {
                submenu.classList.remove('active');
            });
            
            dotsMenu.style.opacity = '0';
            dotsMenu.style.transform = 'translateY(10px) scale(0.95)';
            dotsOverlay.style.opacity = '0';
            
            setTimeout(() => {
                dotsMenu.style.display = 'none';
                dotsOverlay.style.display = 'none';
                menuItems.forEach(item => {
                    item.style.animation = '';
                });
            }, 300);
            
            dotsMenuJustOpened = false;
            if (dotsMenuTimeout) clearTimeout(dotsMenuTimeout);
        }

        function handleDotsButtonClick(e) {
            e.stopPropagation();
            e.preventDefault();
            
            if (dotsMenu.style.display !== 'block') {
                toggleDotsMenu();
            }
        }

        dotsButton.addEventListener('touchstart', handleDotsButtonClick);
        dotsButton.addEventListener('click', handleDotsButtonClick);

        dotsMenu.addEventListener('click', function(e) {
            const menuItem = e.target.closest('.menu-item-with-icon');
            const submenuItem = e.target.closest('.submenu-item');
            
            if (submenuItem) {
                const action = submenuItem.getAttribute('data-action');
                const url = submenuItem.getAttribute('data-url');
                const target = submenuItem.getAttribute('data-target');
                handleAction(action, url, target);
                closeDotsMenu();
                return;
            }
            
            if (menuItem && !menuItem.classList.contains('submenu-parent')) {
                const action = menuItem.getAttribute('data-action');
                handleAction(action);
                closeDotsMenu();
            }
        });

        // –û–ë–†–ê–ë–û–¢–ö–ê –í–°–ï–• –ü–û–î–ú–ï–ù–Æ (–∑–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–¥–Ω–æ–≥–æ)
        const submenuParents = dotsMenu.querySelectorAll('.submenu-parent');
        
        submenuParents.forEach(parent => {
            parent.addEventListener('click', function(e) {
                e.stopPropagation();
                
                // –ù–∞–π—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω–æ–µ –ø–æ–¥–º–µ–Ω—é (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)
                const submenu = this.nextElementSibling;
                if (!submenu || !submenu.classList.contains('submenu')) return;
                
                // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–¥–º–µ–Ω—é
                submenuParents.forEach(otherParent => {
                    if (otherParent !== this) {
                        otherParent.classList.remove('active');
                        const otherSubmenu = otherParent.nextElementSibling;
                        if (otherSubmenu && otherSubmenu.classList.contains('submenu')) {
                            otherSubmenu.classList.remove('active');
                        }
                    }
                });
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–¥–º–µ–Ω—é
                const isActive = this.classList.contains('active');
                if (isActive) {
                    this.classList.remove('active');
                    submenu.classList.remove('active');
                } else {
                    this.classList.add('active');
                    submenu.classList.add('active');
                }
            });
        });

        dotsOverlay.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (!dotsMenuJustOpened) {
                closeDotsMenu();
            }
            return false;
        });

        document.addEventListener('click', function(e) {
            if (dotsMenu.style.display === 'block' && 
                !dotsMenu.contains(e.target) && 
                !dotsButton.contains(e.target)) {
                
                closeDotsMenu();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && dotsMenu.style.display === 'block') {
                closeDotsMenu();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞
        function handleOrientationChange() {
            setTimeout(() => {
                if (dotsMenu.style.display === 'block') {
                    closeDotsMenu();
                }
            }, 100);
        }

        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ —Å—Ç–∞—Ä–æ–≥–æ, —Ç–∞–∫ –∏ –Ω–æ–≤–æ–≥–æ API
        window.addEventListener('orientationchange', handleOrientationChange);
        window.addEventListener('resize', function() {
            // –î–ª—è iOS –∏ –¥—Ä—É–≥–∏—Ö, –≥–¥–µ orientationchange –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
            if (dotsMenu.style.display === 'block') {
                const currentWidth = window.innerWidth;
                const currentHeight = window.innerHeight;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —ç—Ç–æ –ø–æ–≤–æ—Ä–æ—Ç, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ resize
                if (Math.abs(currentWidth - window.lastWidth) > 50 || 
                    Math.abs(currentHeight - window.lastHeight) > 50) {
                    window.lastWidth = currentWidth;
                    window.lastHeight = currentHeight;
                    handleOrientationChange();
                }
            }
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
        window.lastWidth = window.innerWidth;
        window.lastHeight = window.innerHeight;

        window.addEventListener('scroll', closeDotsMenu);
    });
</script>



































<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* –î–æ–±–∞–≤–ª—è–µ–º —à—Ä–∏—Ñ—Ç Montserrat */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap');

    .emiia-button-container {
        position: fixed;
        bottom: 70px;
        left: 30px;
        z-index: 1000;
    }

    .emiia-button-wrapper {
        display: flex;
        align-items: center;
        background: rgba(204, 204, 204, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 18px;
        padding: 5.5px 12px;
        gap: 11px;
        box-shadow: 0 0px 0px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(204, 204, 204, 0.1);
        transition: all 0.3s ease;
        font-family: 'Orbitron', sans-serif;
    }

    .emiia-button-wrapper:hover {
        background: rgba(204, 204, 204, 0.8);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        transform: translateY(-2px);
    }

    .emiia-button-wrapper:active {
        transform: translateY(0);
    }

    .dots-button {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

    .dots-icon {
        width: 16px;
        height: 16px;
        fill: white;
    }

    .emiia-button {
        background: transparent;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        font-family: 'Orbitron', sans-serif;
        padding: 0;
    }

    .arrow-icon {
        width: 18px;
        height: 18px;
        fill: white;
        stroke: white;
        stroke-width: 1.5;
        transition: transform 0.3s ease;
    }

    .emiia-button.active .arrow-icon {
        transform: rotate(180deg);
    }

    .emiia-menu {
        position: absolute;
        bottom: 100%;
        left: 0;
        margin-bottom: 10px;
        background: transparent;
        border-radius: 12px;
        min-width: 250px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: all 0.3s ease;
    }

    .emiia-menu.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .dots-menu {
        position: absolute;
        bottom: 100%;
        left: 0;
        margin-bottom: 10px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 18px;
        max-width: 235px;
         min-width: 235px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px);
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        z-index: 1001;
        padding: 8px 0;
        color: #383838;
        /* –ü—Ä–∏–º–µ–Ω—è–µ–º Montserrat –¥–ª—è –º–µ–Ω—é —Ç–æ—á–µ–∫ */
        font-family: 'Montserrat', sans-serif;
        font-size: 14px;
        font-weight: 500;
        line-height: 1.4;
    }

    .dots-menu.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .menu-item {
        padding: 8px 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        border-bottom: none;
        /* –ü—Ä–∏–º–µ–Ω—è–µ–º Montserrat –¥–ª—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é */
        font-family: 'Montserrat', sans-serif;
    }

    .menu-item:hover {
        background-color: rgba(245, 245, 245, 0.8);
        color: #383838;
    }

    .refresh-item, .settings-item, .install-item, .navigation-item, .datasets-item, .terms-item, .privacy-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        border-bottom: none;
        font-weight: 500;
        /* –ü—Ä–∏–º–µ–Ω—è–µ–º Montserrat –¥–ª—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é —Ç–æ—á–µ–∫ */
        font-family: 'Montserrat', sans-serif;
    }

    .refresh-item:hover, .settings-item:hover, .install-item:hover, .navigation-item:hover, .datasets-item:hover, .terms-item:hover, .privacy-item:hover {
        background-color: rgba(245, 245, 245, 0.8);
    }

    .refresh-icon, .settings-icon, .install-icon, .navigation-icon, .datasets-icon, .terms-icon, .privacy-icon {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
    }

    .menu-divider {
        height: 1px;
        background-color: #e0e0e0;
        margin: 4px 0;
    }

    .menu-content {
        padding: 0px 0px;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 768px) {
        .emiia-button-container {
            bottom: 24px;
            left: 18px;
        }
        
        .emiia-button-wrapper {
            padding: 6.5px 12px;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        .emiia-button {
            font-size: 12px;
            font-weight: 600;
        }
        
        .emiia-menu {
            min-width: 270px;
        }

        .dots-menu {
            min-width: 235px;
            font-weight: 500;
            /* –°–æ—Ö—Ä–∞–Ω—è–µ–º Montserrat –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            font-family: 'Montserrat', sans-serif;
        }
    }

    #info {
        background: transparent;
        padding: 0px;
        margin: 0px;
        position: relative;
        top: -7px;
        color: #3d85c6;
        /* –ü—Ä–∏–º–µ–Ω—è–µ–º Montserrat –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
        font-family: 'Montserrat', sans-serif;
        font-size: 12px;
        font-weight: 500;
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow-y: auto;
    }


 .menu-content {
            padding: 0px 7px;
        }


    @media (max-width: 768px) {
        .emiia-menu {
            min-width: 280px;
        }
        
        .menu-content {
            padding: 0px 7px;
        }





#dotsMenu {
    z-index: 10000 !important;
    position: fixed;
    /* –î–æ–±–∞–≤—å —Å–≤–æ–∏ —Å—Ç–∏–ª–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
}

#dotsButton {
    z-index: 10001 !important;
    position: relative;
}

#dotsOverlay {
    z-index: 9998 !important;
}











    }
</style>







<style>


 /* –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–∏–∂–Ω–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω—ã –¥–ª—è PWA —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–æ–º (—Ü–≤–µ—Ç –∏–∫–æ–Ω–æ–∫ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞ –±–µ–ª—ã–π –∏–ª–∏ —á–µ—Ä–Ω—ã–π –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥ —Ç–µ–º—É */

body {
    margin: 0;
    padding: 0;
    height: 100vh;
    overflow: hidden;
}

#map {
    position: fixed;
    top: -100px; /* –í—ã–ª–∞–∑–∏–º –∑–∞ –≤–µ—Ä—Ö */
    bottom: -100px; /* –í—ã–ª–∞–∑–∏–º –∑–∞ –Ω–∏–∑ */
    left: 0;
    right: 0;
    background: #f8f9fa;
    /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –≤—Å–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã */
    margin: 0 !important;
    padding: 0 !important;
}
</style>





<style>

/* –ò–∫–æ–Ω–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é –ø–æ-—Ü–µ–Ω—Ç—Ä—É */
.floating-icon {
    position: fixed;
    z-index: 1000;
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è */
@media (max-width: 768px) {
    .floating-icon {
        bottom: 8.3%;
        left: 50%;
        transform: translateX(-50%);
    }
}

/* –î–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è */
@media (min-width: 769px) {
 .floating-icon {
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
    }
}
</style>






<!-- –ö–Ω–æ–ø–∫–∞ EMIIA.AI -->
<div class="emiia-button-container">
    <div class="emiia-button-wrapper">
        <button class="dots-button" id="dotsButton">
            <svg class="dots-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>
            </svg>
        </button>
        
        <button class="emiia-button" id="emiiaButton">
            EMIIA.AI SIP
            <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" width="17" height="17" fill="currentColor" viewBox="0 0 17 17">
                <path stroke="currentColor" stroke-width="0.8" fill="currentColor" fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708z"/>
            </svg>
        </button>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é (EMIIA.AI SIP + —Å—Ç—Ä–µ–ª–∫–∞) -->
    <div class="emiia-menu" id="emiiaMenu">
        <div class="menu-content">


            <div class="menu-item"></div>
            <pre id="info"></pre>
            <p>EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ<br>EMIIA.AI SIP: [<strong><span </span>AI WMS</strong>] ID R: [#3D4581] 
            <span class="highlight1"></span></p>
        </div>
    </div>

    <!-- –ú–µ–Ω—é —Ç–æ—á–µ–∫ -->
    <div class="dots-menu" id="dotsMenu">
        <div class="settings-item" id="settingsItem">
            <svg class="settings-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
            </svg>
            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="refresh-item" id="refreshItem">
            <svg class="refresh-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
            </svg>
            –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="install-item" id="installItem">
            <svg class="install-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
            </svg>
            –ü–û EMIIA.AI
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="navigation-item" id="navigationItem">
            <svg class="navigation-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" fill-rule="evenodd" d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411"/>
            </svg>
            –ù–∞–≤–∏–≥–∞—Ü–∏—è
        </div>

<div class="menu-divider"></div>
        
        <div class="datasets-item" id="datasetsItem">
            <svg class="datasets-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M14 4.5V11h-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM4.151 15.29a1.2 1.2 0 0 1-.111-.449h.764a.58.58 0 0 0 .255.384q.105.073.25.114.142.041.319.041.245 0 .413-.07a.56.56 0 0 0 .255-.193.5.5 0 0 0 .084-.29.39.39 0 0 0-.152-.326q-.152-.12-.463-.193l-.618-.143a1.7 1.7 0 0 1-.539-.214 1 1 0 0 1-.352-.367 1.1 1.1 0 0 1-.123-.524q0-.366.19-.639.192-.272.528-.422.337-.15.777-.149.456 0 .779.152.326.153.5.41.18.255.2.566h-.75a.56.56 0 0 0-.12-.258.6.6 0 0 0-.246-.181.9.9 0 0 0-.37-.068q-.324 0-.512.152a.47.47 0 0 0-.185.384q0 .18.144.3a1 1 0 0 0 .404.175l.621.143q.326.075.566.211a1 1 0 0 1 .375.358q.135.222.135.56 0 .37-.188.656a1.2 1.2 0 0 1-.539.439q-.351.158-.858.158-.381 0-.665-.09a1.4 1.4 0 0 1-.478-.252 1.1 1.1 0 0 1-.29-.375m-3.104-.033a1.3 1.3 0 0 1-.082-.466h.764a.6.6 0 0 0 .074.27.5.5 0 0 0 .454.246q.285 0 .422-.164.137-.165.137-.466v-2.745h.791v2.725q0 .66-.357 1.005-.355.345-.985.345a1.6 1.6 0 0 1-.568-.094 1.15 1.15 0 0 1-.407-.266 1.1 1.1 0 0 1-.243-.39m9.091-1.585v.522q0 .384-.117.641a.86.86 0 0 1-.322.387.9.9 0 0 1-.47.126.9.9 0 0 1-.47-.126.87.87 0 0 1-.32-.387 1.55 1.55 0 0 1-.117-.641v-.522q0-.386.117-.641a.87.87 0 0 1 .32-.387.87.87 0 0 1 .47-.129q.265 0 .47.129a.86.86 0 0 1 .322.387q.117.255.117.641m.803.519v-.513q0-.565-.205-.973a1.46 1.46 0 0 0-.59-.63q-.38-.22-.916-.22-.534 0-.92.22a1.44 1.44 0 0 0-.589.628q-.205.407-.205.975v.513q0 .562.205.973.205.407.589.626.386.217.92.217.536 0 .917-.217.384-.22.589-.626.204-.41.205-.973m1.29-.935v2.675h-.746v-3.999h.662l1.752 2.66h.032v-2.66h.75v4h-.656l-1.761-2.676z"/>
            </svg>
            –î–∞—Ç–∞—Å–µ—Ç—ã
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="terms-item" id="termsItem">
            <svg class="terms-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
            </svg>
            –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="privacy-item" id="privacyItem">
            <svg class="privacy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#383838" viewBox="0 0 16 16">
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .101.025 1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56"/>
                <path stroke="#3d85c6" 
        stroke-width="0.5"
        fill="#3d85c6" d="M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0"/>
            </svg>
            –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
        </div>
    </div>
</div>








<div class="floating-icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"  viewBox="0 0 16 16">
        <path stroke="#dadada" 
        stroke-width="0.5"
        fill="#dadada" d="M7.776 5.553a.5.5 0 0 1 .448 0l6 3a.5.5 0 1 1-.448.894L8 6.56 2.224 9.447a.5.5 0 1 1-.448-.894z"/>
    </svg>
</div>







<div id="map"></div>



















<script>



mapboxgl.accessToken = 'YOUR_EMIIA_AI_ACCESS_TOKEN';

const map = new mapboxgl.Map({
    container: 'map', 
    style: 'https://sos.emiia.ai/moscow_style_2.json ',
    zoom: 18.3,
    minZoom: 9,
    maxZoom: 20.5,
    center: [37.63567614,55.83837533],
    hash: true,
    turn: false,
    attributionControl: false,
    bearing: 0,
    pitch: 45,
    antialias: true 
});

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
let isLocationActive = false;
let compassHideTimer;

// –°–∏–Ω—è—è —Ç–æ—á–∫–∞ —Å –≤–æ–ª–Ω–∞–º–∏ #3d85c6 - —Ä–∞–∑–º–µ—Ä 110px
const pulsingDotBlue = {
    width: 110,
    height: 110,
    data: new Uint8Array(110 * 110 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const duration = 1800;
        const pulseDuration = 700;
        const t = (performance.now() % duration) / duration;
        const pulseT = (performance.now() % pulseDuration) / pulseDuration;
        const context = this.context;

        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const maxRadius = this.width / 2 * 1;
        const sweepAngle = Math.PI * 2 * 1.7 * t;
        const opacity = 0.8 * Math.pow(1 - t, 2);

        context.beginPath();
        context.moveTo(centerX, centerY);
        context.arc(centerX, centerY, maxRadius, Math.PI / 2, sweepAngle + Math.PI / 2);
        context.closePath();

        context.fillStyle = `rgba(61, 133, 198, ${opacity})`;
        context.fill();

        const radius = (this.width / 2) * 0.35;
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = 'rgba(61, 133, 198, 1)';
        context.strokeStyle = '#f8f9fa';

        context.lineWidth = 2.5 + 2.5 * Math.abs(Math.sin(Math.PI * pulseT));
        context.fill();
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        map.triggerRepaint();

        return true;
    }
};

// –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–º–ø–∞—Å —Å —Ç–≤–æ–∏–º SVG
function createCustomCompass() {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–º–ø–∞—Å –µ—Å–ª–∏ –µ—Å—Ç—å
    const oldCompass = document.getElementById('custom-compass');
    if (oldCompass) {
        oldCompass.remove();
    }

    const compass = document.createElement('button');
    compass.id = 'custom-compass';
    
    // –¢–≤–æ–π SVG –∫–æ–º–ø–∞—Å —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º fill –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
    compass.innerHTML = `
        <svg
            xmlns="http://www.w3.org/2000/svg "
            class="compass-icon"
            stroke-linejoin="round"
            stroke-linecap="round"
            stroke-width="0.8"
            stroke="#3d85c6"
            stroke-opacity="0.8"
            viewBox="0 0 15 15"
            fill="transparent"
            height="20"
            width="20">
            <path
                fill="transparent"
                stroke="#3d85c6"
                stroke-width="2"
                id="compass-path"
                d="M 8.0541549,2.4921492 A 0.5,0.40619867 0 0 1 8.521609,2.7520459 l 5.03092,10.5515841 a 0.5,0.40619867 0 0 1 -0.651832,0.524015 L 8.0828433,12.271588 3.272759,13.846285 A 0.5,0.40619867 0 0 1 2.6192748,13.324799 L 7.5882307,2.753853 A 0.5,0.40619867 0 0 1 8.0534494,2.4927249 Z" />
        </svg>
    `;
    
    compass.style.cssText = `
        position: absolute;
        top: 40%; /* –ß—É—Ç—å –≤—ã—à–µ —Å–µ—Ä–µ–¥–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ */
        left: 20px;
        width: 40px;
        height: 40px;
        background: transparent;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        transition: all 0.3s ease;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-50%);
    `;

    compass.addEventListener('click', handleCompassClick);
    compass.title = '–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';

    document.body.appendChild(compass);
    return compass;
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Å—Ç–æ–º–Ω–æ–º—É –∫–æ–º–ø–∞—Å—É
function handleCompassClick() {
    if (isLocationActive) {
        removeUserLocation();
    } else {
        locateUser();
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
function removeUserLocation() {
    if (map.getSource('user-location')) {
        map.removeLayer('user-location-layer');
        map.removeSource('user-location');
    }
    isLocationActive = false;
    updateCompassAppearance();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –∫–æ–º–ø–∞—Å–∞
function updateCompassAppearance() {
    const compass = document.getElementById('custom-compass');
    const compassPath = document.getElementById('compass-path');
    const compassIcon = document.querySelector('.compass-icon');
    
    if (compass && compassPath && compassIcon) {
        if (isLocationActive) {
            // –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - —Å–∏–Ω–∏–π fill
            compassPath.setAttribute('fill', '#3d85c6');
            compassIcon.setAttribute('fill', '#3d85c6');
            compass.style.backgroundColor = 'rgba(61, 133, 198, 0.0)';
            compass.title = '–°–∫—Ä—ã—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
        } else {
            // –ù–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π fill
            compassPath.setAttribute('fill', 'transparent');
            compassIcon.setAttribute('fill', 'transparent');
            compass.style.backgroundColor = 'rgba(255, 255, 255, 0.0)';
            compass.title = '–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
        }
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–º–ø–∞—Å–∞
function showCompass() {
    const compass = document.getElementById('custom-compass');
    if (compass) {
        clearTimeout(compassHideTimer);
        compass.style.opacity = '1';
        compass.style.visibility = 'visible';
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∫–æ–º–ø–∞—Å–∞ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ)
function hideCompass() {
    if (!isLocationActive) {
        const compass = document.getElementById('custom-compass');
        if (compass) {
            compass.style.opacity = '0';
            compass.style.visibility = 'hidden';
        }
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
function locateUser() {
    if (!navigator.geolocation) {
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
        return;
    }

    navigator.geolocation.getCurrentPosition(
        (position) => {
            const { longitude, latitude } = position.coords;
            
            map.flyTo({
                center: [longitude, latitude],
                zoom: 17,
                duration: 2000,
                essential: true
            });

            removeUserLocation();

            map.addImage('pulsing-dot-blue', pulsingDotBlue, { pixelRatio: 2 });
            
            map.addSource('user-location', {
                type: 'geojson',
                data: {
                    type: 'FeatureCollection',
                    features: [
                        {
                            type: 'Feature',
                            geometry: {
                                type: 'Point',
                                coordinates: [longitude, latitude]
                            }
                        }
                    ]
                }
            });

            map.addLayer({
                id: 'user-location-layer',
                type: 'symbol',
                source: 'user-location',
                layout: {
                    'icon-image': 'pulsing-dot-blue',
                    'icon-allow-overlap': true,
                    'icon-ignore-placement': true
                }
            });

            isLocationActive = true;
            updateCompassAppearance();
            showCompass();

        },
        (error) => {
            let errorMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
            
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = '–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.';
                    break;
                case error.TIMEOUT:
                    errorMessage = '–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ.';
                    break;
            }
            
            alert(errorMessage);
        },
        {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000
        }
    );
}

// –°–æ–∑–¥–∞–µ–º –∫–æ–º–ø–∞—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
createCustomCompass();

// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–æ–º–ø–∞—Å–∞
map.on('rotate', function() {
    const compass = document.getElementById('custom-compass');
    if (compass) {
        const bearing = map.getBearing();
        const compassIcon = compass.querySelector('.compass-icon');
        if (compassIcon) {
            compassIcon.style.transform = `rotate(${-bearing}deg)`;
        }
    }
});

// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –Ω–∞–∫–ª–æ–Ω –∏–∫–æ–Ω–∫–∏ –∫–æ–º–ø–∞—Å–∞
map.on('pitch', function() {
    const compass = document.getElementById('custom-compass');
    if (compass) {
        const currentPitch = map.getPitch();
        const maxCompassPitch = 0;
        const limitedPitch = Math.min(currentPitch, maxCompassPitch);
        
        compass.style.transform = `translateY(-50%) perspective(500px) rotateX(${limitedPitch}deg)`;
    }
});

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–ø–∞—Å –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –ø–æ–≤–æ—Ä–æ—Ç–∞
map.on('rotatestart', function() {
    showCompass();
});

// –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–º–ø–∞—Å —á–µ—Ä–µ–∑ 7 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞
map.on('rotateend', function() {
    if (!isLocationActive) {
        compassHideTimer = setTimeout(() => {
            hideCompass();
        }, 7000);
    }
});

// –£–î–ê–õ–ï–ù–û: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–ª –ø–æ–∫–∞–∑ –∫–æ–º–ø–∞—Å–∞
// map.on('click', function(e) { ... });

map.on('load', () => {
    console.log('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
});


























map.on('load', () => {
    const layers = map.getStyle().layers;
    let labelLayerId;
    for (let i = 0; i < layers.length; i++) {
        if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
            labelLayerId = layers[i].id;
            break;
        }
    }

    map.addSource('openmaptiles', {
        url: 'https://sos.emiia.ai/tiles.json',
        type: 'vector',
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–ª–µ–Ω—É—é –ø–æ–¥–ª–æ–∂–∫—É –ü–û–î –∑–¥–∞–Ω–∏—è–º–∏
    map.addLayer({
        'id': 'green-base',
        'source': 'openmaptiles',
        'source-layer': 'building',
        'type': 'fill',
        'minzoom': 14,
        'maxzoom': 24,
        'paint': {
            'fill-color': '#a4c2f4',
            'fill-opacity': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 0.3,
                15.5, 0.3,
                18, 0.3,
                22, 0.3
            ]
        }
    }, labelLayerId);

    // –î–æ–±–∞–≤–ª—è–µ–º –±–µ–ª—ã–µ –ª–∏–Ω–∏–∏ –ø–æ –∫–æ–Ω—Ç—É—Ä—É –∑–¥–∞–Ω–∏–π
    map.addLayer({
        'id': 'building-outlines',
        'source': 'openmaptiles',
        'source-layer': 'building',
        'type': 'line',
        'minzoom': 14,
        'maxzoom': 24,
        'paint': {
            'line-color': '#ffffff', // –ë–µ–ª—ã–π —Ü–≤–µ—Ç
            'line-width': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 1,  // –¢–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è –ø—Ä–∏ –æ—Ç–¥–∞–ª–µ–Ω–∏–∏
                16, 2,    // –°—Ä–µ–¥–Ω—è—è —Ç–æ–ª—â–∏–Ω–∞
                18, 2,    // –¢–æ–ª—â–µ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏
                20, 5     // –ï—â–µ —Ç–æ–ª—â–µ –ø—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏
            ],
            'line-opacity': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 1,
                15.5, 1,
                18, 1,
                22, 1
            ]
        }
    }, labelLayerId);

    // –ó–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º 3D –∑–¥–∞–Ω–∏—è –ø–æ–≤–µ—Ä—Ö –∑–µ–ª–µ–Ω–æ–π –ø–æ–¥–ª–æ–∂–∫–∏ –∏ –∫–æ–Ω—Ç—É—Ä–æ–≤
    map.addLayer({
        'id': '3d-buildings',
        'source': 'openmaptiles',
        'source-layer': 'building',
        'type': 'fill-extrusion',
        'minzoom': 14,
        'maxzoom': 19,
        'paint': {
            'fill-extrusion-color': [
                'interpolate',
                ['linear'],
                ['get', 'render_height'],
                1, '#e4e4e4',
                200, '#e4e4e4',
                400, '#e4e4e4'
            ],
            'fill-extrusion-height': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 0,
                15.5, ['get', 'render_height']
            ],
            'fill-extrusion-base': [
                'case',
                ['>=', ['get', 'zoom'], 16.5],
                ['get', 'render_min_height'],
                0
            ],
            'fill-extrusion-opacity': [
                'interpolate',
                ['linear'],
                ['zoom'],
                14, 0,
                15.5, 0.8,
                18, 0.0
            ]
        }
    }, labelLayerId);
});
















map.on('load', function() {
    // –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ GeoJSON
    const geoJsonData = {
        "type": "FeatureCollection",
        "features": [
            {
                "type": "Feature",
                "properties": {
                    "height": 9
                },
                "geometry": {
                    "coordinates": [
                        [
                            [37.63623267958914, 55.83858608472792],
                            [37.635924239992505, 55.838205919256666],
                            [37.635295481554095, 55.83836646017602],
                            [37.63560420713637, 55.83874600795269],
                            [37.63623267958914, 55.83858608472792]
                        ]
                    ],
                    "type": "Polygon"
                }
            }
        ]
    };

    // –ü–µ—Ä–≤—ã–π —Å–ª–æ–π - –ø–ª–æ—Å–∫–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞)
    map.addLayer({
        id: 'base-layer',
        type: 'fill',
        source: {
            type: 'geojson',
            data: geoJsonData
        },
        paint: {
            'fill-color': '#a4c2f4',
            'fill-opacity': 0.6
        }
    });

    // –í—Ç–æ—Ä–æ–π —Å–ª–æ–π - —ç–∫—Å—Ç—Ä—É–∑–∏—è (–∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ –∑—É–º–µ 19 –∏ –≤—ã—à–µ)
    map.addLayer({
        id: 'extruded-layer',
        type: 'fill-extrusion',
        source: {
            type: 'geojson',
            data: geoJsonData
        },
        paint: {
            'fill-extrusion-color': '#a4c2f4',
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': 0,
            'fill-extrusion-opacity': [
                'interpolate',
                ['linear'],
                ['zoom'],
                18, 0.09,    // –ø—Ä–∏ –∑—É–º–µ 18 - –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.4
                19, 0       // –ø—Ä–∏ –∑—É–º–µ 19 –∏ –≤—ã—à–µ - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω–∞
            ]
        }
    });
});




map.on('load', function() {
    // –ü–µ—Ä–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ - —Ä–∞–π–æ–Ω—ã –ú–æ—Å–∫–≤—ã
    map.addSource('moscow-data', {
        type: 'geojson',
        data: 'https://sos.emiia.ai/moscow.geojson'
    });
    
    // –í—Ç–æ—Ä–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ - –ª–∏–Ω–∏–∏ –º–µ—Ç—Ä–æ
    map.addSource('metro-lines', {
        type: 'geojson',
        data: 'https://www.emiia.ru/mapnew/data/Metro-lines-230302.geojson'
    });
    
    // –ó–∞–ª–∏–≤–∫–∞ —Ä–∞–π–æ–Ω–æ–≤
    map.addLayer({
        id: 'moscow-districts-fill',
        type: 'fill',
        source: 'moscow-data',
        paint: {
            'fill-color': [
                'case',
                ['has', 'color'], ['get', 'color'],
                'transparent'
            ],
            'fill-opacity': 0.2
        }
    });
    
    // –ì—Ä–∞–Ω–∏—Ü—ã —Ä–∞–π–æ–Ω–æ–≤ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç–æ–ª—â–∏–Ω–æ–π
    map.addLayer({
        id: 'moscow-districts-border',
        type: 'line',
        source: 'moscow-data',
        paint: {
            'line-color': 'white',
            'line-width': [
                'interpolate',
                ['linear'],
                ['zoom'],
                8, 1,    // –ø—Ä–∏ –∑—É–º–µ 8 - —Ç–æ–ª—â–∏–Ω–∞ 1px
                12, 3,   // –ø—Ä–∏ –∑—É–º–µ 12 - —Ç–æ–ª—â–∏–Ω–∞ 3px  
                16, 5    // –ø—Ä–∏ –∑—É–º–µ 16 - —Ç–æ–ª—â–∏–Ω–∞ 5px
            ],
            'line-opacity': 0.8
        }
    });
    
    // –ü–æ–¥–ø–∏—Å–∏ —Ä–∞–π–æ–Ω–æ–≤
    map.addLayer({
        id: 'moscow-districts-labels',
        type: 'symbol',
        source: 'moscow-data',
        layout: {
            'text-field': ['get', 'name'],
            'text-size': 12,
            'text-font': ['Open Sans Bold']
        },
        paint: {
            'text-color': 'transparent',
            'text-halo-color': 'transparent',
            'text-halo-width': 1
        }
    });

    // –õ–∏–Ω–∏–∏ –º–µ—Ç—Ä–æ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç–æ–ª—â–∏–Ω–æ–π
    map.addLayer({
        id: 'metro-lines',
        type: 'line',
        source: 'metro-lines',
        paint: {
            'line-color': [
                'case',
                ['has', 'color'], ['get', 'color'],
                'white'
            ],
            'line-width': [
                'interpolate',
                ['linear'],
                ['zoom'],
                8, 2,    // –ø—Ä–∏ –∑—É–º–µ 8 - —Ç–æ–ª—â–∏–Ω–∞ 2px
                12, 4,   // –ø—Ä–∏ –∑—É–º–µ 12 - —Ç–æ–ª—â–∏–Ω–∞ 4px
                16, 6    // –ø—Ä–∏ –∑—É–º–µ 16 - —Ç–æ–ª—â–∏–Ω–∞ 6px
            ],
            'line-opacity': 0.8
        }
    });

    // –ö–æ–Ω—Ç—É—Ä –ª–∏–Ω–∏–π –º–µ—Ç—Ä–æ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç–æ–ª—â–∏–Ω–æ–π
    map.addLayer({
        id: 'metro-lines-outline',
        type: 'line',
        source: 'metro-lines',
        paint: {
            'line-color': 'white',
            'line-width': [
                'interpolate',
                ['linear'],
                ['zoom'],
                8, 3,    // –ø—Ä–∏ –∑—É–º–µ 8 - —Ç–æ–ª—â–∏–Ω–∞ 3px
                12, 5,   // –ø—Ä–∏ –∑—É–º–µ 12 - —Ç–æ–ª—â–∏–Ω–∞ 5px
                16, 7    // –ø—Ä–∏ –∑—É–º–µ 16 - —Ç–æ–ª—â–∏–Ω–∞ 7px
            ],
            'line-opacity': 0.6
        }
    });

    // –ü–æ–¥–ø–∏—Å–∏ –ª–∏–Ω–∏–π –º–µ—Ç—Ä–æ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–º–µ—Ä–æ–º —Ç–µ–∫—Å—Ç–∞
    map.addLayer({
        id: 'metro-lines-labels',
        type: 'symbol',
        source: 'metro-lines',
        layout: {
            'text-field': ['get', 'name'],
            'text-size': [
                'interpolate',
                ['linear'],
                ['zoom'],
                8, 8,    // –ø—Ä–∏ –∑—É–º–µ 8 - —Ä–∞–∑–º–µ—Ä 8px
                12, 10,  // –ø—Ä–∏ –∑—É–º–µ 12 - —Ä–∞–∑–º–µ—Ä 10px
                16, 12   // –ø—Ä–∏ –∑—É–º–µ 16 - —Ä–∞–∑–º–µ—Ä 12px
            ],
            'text-font': ['Open Sans Bold'],
            'symbol-placement': 'line'
        },
        paint: {
            'text-color': '#e4e4e4',
            'text-halo-color': '#f8f9fa',
            'text-halo-width': 2
        }
    });
});















var geojson = {
  'type': 'FeatureCollection',
  'features': [
    {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [37.63147405, 55.83441285]
      },
      'properties': {
        'title': 'EMIIA.AI SIP STORE #21',
        'description': 'EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ EMIIA.AI SIP: ID R: [#3D4581] <br> #21'
      }
    }
  ]
};

// add markers to map
geojson.features.forEach(function (marker) {
  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker';

  // make a marker for each feature and add it to the map
  var markerObj = new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(
      new mapboxgl.Popup({ offset: 25 })
        .setHTML(
          '<h3>' +
            marker.properties.title +
            '</h3><p>' +
            marker.properties.description +
            '</p>'
        )
    )
    .addTo(map);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –º–∞—Ä–∫–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑—É–º–∞
  function updateMarkerVisibility() {
    var zoom = map.getZoom();
    var opacity = Math.max(0, Math.min(1, (17 - zoom) / 2));
    
    el.style.opacity = opacity;
    
    if (zoom >= 17) {
      el.style.display = 'none';
    } else {
      el.style.display = 'block';
    }
  }

  // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑—É–º–∞
  map.on('zoom', updateMarkerVisibility);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  updateMarkerVisibility();
});








var geojson = {
  'type': 'FeatureCollection',
  'features': [
    {
      'type': 'Feature',
      'geometry': {
        'type': 'Point',
        'coordinates': [37.63563151,55.83852133]
      },
      'properties': {
        'title': 'EMIIA.AI SIP <br>DARK STORE #33',
        'description': 'EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ <br>EMIIA.AI DBM: ID R: [#3D4581] <br>'
      }
    }
  ]
};

// add markers to map
geojson.features.forEach(function (marker) {
  // create a HTML element for each feature
  var el = document.createElement('div');
  el.className = 'marker1';

  // make a marker for each feature and add it to the map
  var markerObj = new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(
      new mapboxgl.Popup({ offset: 25 }) // add popups
        .setHTML(
          '<h3>' +
            marker.properties.title +
            '</h3><p>' +
            marker.properties.description +
            '</p>'
        )
    )
    .addTo(map);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –º–∞—Ä–∫–µ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑—É–º–∞
  function updateMarkerVisibility() {
    var zoom = map.getZoom();
    var opacity = Math.max(0, Math.min(1, (17 - zoom) / 2));
    
    el.style.opacity = opacity;
    
    if (zoom >= 17) {
      el.style.display = 'none';
    } else {
      el.style.display = 'block';
    }
  }

  // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑—É–º–∞
  map.on('zoom', updateMarkerVisibility);

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  updateMarkerVisibility();
});


















 


  map.on('load', () => {
        map.setPaintProperty('building', 'fill-color', [
            'interpolate',
            // Set the exponential rate of change to 0.5
            ['exponential', 1],
            ['zoom'],
            // When zoom is 15, buildings will be beige.
            15,
            'red',
            // When zoom is 18 or higher, buildings will be yellow.
            18,
            'red'
        ]);

        map.setPaintProperty('building', 'fill-opacity', [
            'interpolate',
            // Set the exponential rate of change to 0.5
            ['exponential', 1],
            ['zoom'],
            // When zoom is 10, buildings will be 100% transparent.
            10,
            0.5,
            // When zoom is 18 or higher, buildings will be 100% opaque.
            18,
            1
        ]);
    });








  










map.on('style.load', () => {
        // set the light preset to be in dusk mode.
        map.setConfigProperty('basemap', 'lightPreset', 'dusk');

        // add a geojson source with a polygon to be used in the clip layer.
        map.addSource('eraser', {
            'type': 'geojson',
            'data': {
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'properties': {},
                        'geometry': {
                            'coordinates': [
                                [
                                    [
            37.63138653415112,
            55.83397767687967
          ],
          [
            37.631323474598645,
            55.83401161180973
          ],
          [
            37.63138506034616,
            55.834039583692146
          ],
          [
            37.63144337877924,
            55.83400424627024
          ],
          [
            37.63138653415112,
            55.83397767687967
          ]
                                ]
                            ],
                            'type': 'Polygon'
                        }
                    }
                ]
            }
        });





















// –°–æ–∑–¥–∞–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –ø—É–ª—å—Å–∏—Ä—É—é—â—É—é SVG –∏–∫–æ–Ω–∫—É —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –∏ —á–∞—Å—Ç–æ—Ç–æ–π
const createPulsingSVGIcon = (svgPath, baseSize = 70, pulseDuration = 1600) => {
    return {
        width: 250,
        height: 250,
        data: new Uint8Array(250 * 250 * 4),

        onAdd: function () {
            const canvas = document.createElement('canvas');
            canvas.width = this.width;
            canvas.height = this.height;
            this.context = canvas.getContext('2d', { willReadFrequently: true });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º SVG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            this.img = new Image();
            this.img.src = 'data:image/svg+xml;charset=utf-8,' + 
                encodeURIComponent(svgPath);
        },

        render: function () {
            const duration = pulseDuration;
            const t = (performance.now() % duration) / duration;
            const context = this.context;

            context.clearRect(0, 0, this.width, this.height);

            const centerX = this.width / 2;
            const centerY = this.height / 2;
            
            // –ü—É–ª—å—Å–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞
            const scale = 0.9 + 0.1 * Math.sin(t * Math.PI * 2);
            const opacity = 0.8 + 0.2 * Math.sin(t * Math.PI * 2);

            // –†–∞–∑–º–µ—Ä –∏–∫–æ–Ω–∫–∏ (–±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä + –ø—É–ª—å—Å–∞—Ü–∏—è)
            const iconSize = baseSize * scale;

            // –†–∏—Å—É–µ–º SVG –∏–∫–æ–Ω–∫—É
            if (this.img.complete) {
                context.save();
                context.globalAlpha = opacity;
                context.drawImage(
                    this.img, 
                    centerX - iconSize / 2, 
                    centerY - iconSize / 2, 
                    iconSize, 
                    iconSize
                );
                context.restore();
            }

            this.data = context.getImageData(0, 0, this.width, this.height).data;
            map.triggerRepaint();

            return true;
        }
    };
};

// SVG –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞–∫–∞ (–≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫)
const svgExclamation = `
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-octagon" viewBox="0 0 16 16">
  <path  fill="#dc3545" d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
  <path  fill="#dc3545" d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
</svg>
`;

// SVG –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∑–Ω–∞–∫–∞ (—ç–Ω–µ—Ä–≥–∏—è/–º–æ–ª–Ω–∏—è)
const svgEnergy = `
<svg fill="#000000" width="800px" height="800px" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
  <path fill="#dc3545" d="M595.344 64.72h.176-.176zm0 0l-72.207 379.377 261.584.88L428.657 959.28l72.208-417.376-261.568-.912zm.049-63.999c-1.728 0-3.455.063-5.151.19-11.296.913-18.785 4.689-27.664 10.657a64.304 64.304 0 0 0-13.392 11.936 56.688 56.688 0 0 0-3.297 4.288L187.281 502.4c-14.16 19.408-16.24 45.025-5.36 66.433 10.864 21.408 32.832 34.976 56.912 35.152l184.736 1.344-58.08 342.192c-5.52 29.408 10.16 58.72 37.76 70.528a64.19 64.19 0 0 0 25.391 5.216c20.112 0 36.64-9.408 49.041-26.4L836.737 482.56c14.16-19.409 16.225-45.057 5.36-66.433-10.864-21.408-32.832-34.977-56.912-35.152l-184.736-.32 57.456-300.88a62.46 62.46 0 0 0 1.825-15.056c0-34.624-27.569-62.848-62.065-63.968-.767-.032-1.52-.032-2.271-.032z"/>
</svg>
`;



// SVG –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∑–Ω–∞–∫–∞ (–¢–ï–†–ú–û–ú–ï–¢–† –∏ –í–õ–ê–ñ–ù–û–°–¢–¨ –≤ –¥–≤—É—Ö —Ä—è–¥–∞—Ö)
const svgThermometer = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="36" viewBox="0 0 32 36">
    <!-- –í–ï–†–•–ù–ò–ô –†–Ø–î -->
    <!-- –¢–µ—Ä–º–æ–º–µ—Ç—Ä (—Å–ª–µ–≤–∞ —Å–≤–µ—Ä—Ö—É) -->
    <g transform="translate(0, 0)">
        <path fill="#dc3545" d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585a1.5 1.5 0 0 1 1 1.415"/>
        <path fill="#dc3545" d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1"/>
    </g>
    
    <!-- –í–ª–∞–∂–Ω–æ—Å—Ç—å (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É) -->
    <g transform="translate(16, 0)">
        <path fill="#dc3545" d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267"/>
    </g>

    
    
    <!-- –í–ª–∞–∂–Ω–æ—Å—Ç—å (—Å–ø—Ä–∞–≤–∞ —Å–Ω–∏–∑—É) -->
    <g transform="translate(9, 20)">



  <path fill="#dc3545" d="M8 0a1 1 0 0 1 1 1v1.402c0 .511.677.693.933.25l.7-1.214a1 1 0 0 1 1.733 1l-.701 1.214c-.256.443.24.939.683.683l1.214-.701a1 1 0 0 1 1 1.732l-1.214.701c-.443.256-.262.933.25.933H15a1 1 0 1 1 0 2h-1.402c-.512 0-.693.677-.25.933l1.214.701a1 1 0 1 1-1 1.732l-1.214-.7c-.443-.257-.939.24-.683.682l.701 1.214a1 1 0 1 1-1.732 1l-.701-1.214c-.256-.443-.933-.262-.933.25V15a1 1 0 1 1-2 0v-1.402c0-.512-.677-.693-.933-.25l-.701 1.214a1 1 0 0 1-1.732-1l.7-1.214c.257-.443-.24-.939-.682-.683l-1.214.701a1 1 0 1 1-1-1.732l1.214-.701c.443-.256.261-.933-.25-.933H1a1 1 0 1 1 0-2h1.402c.511 0 .693-.677.25-.933l-1.214-.701a1 1 0 1 1 1-1.732l1.214.701c.443.256.939-.24.683-.683l-.701-1.214a1 1 0 0 1 1.732-1l.701 1.214c.256.443.933.261.933-.25V1a1 1 0 0 1 1-1m2 5a1 1 0 1 0-2 0 1 1 0 0 0 2 0M6 7a1 1 0 1 0-2 0 1 1 0 0 0 2 0m1 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m5-3a1 1 0 1 0-2 0 1 1 0 0 0 2 0"/>





    </g>
</svg>`;








// –°–æ–∑–¥–∞–µ–º –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö –∑–Ω–∞–∫–æ–≤ —Å –†–ê–ó–ù–´–ú–ò —Ä–∞–∑–º–µ—Ä–∞–º–∏ –∏ —á–∞—Å—Ç–æ—Ç–∞–º–∏
const exclamationPulsing = createPulsingSVGIcon(svgExclamation, 60, 2000);   // –ü–µ—Ä–≤—ã–π –∑–Ω–∞–∫: —Ä–∞–∑–º–µ—Ä 60, –º–µ–¥–ª–µ–Ω–Ω–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è (2000ms)
const energyPulsing = createPulsingSVGIcon(svgEnergy, 80, 1400);             // –í—Ç–æ—Ä–æ–π –∑–Ω–∞–∫: —Ä–∞–∑–º–µ—Ä 80, –±—ã—Å—Ç—Ä–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è (1000ms)
const thermometerPulsing = createPulsingSVGIcon(svgThermometer, 120, 1600);   // –¢—Ä–µ—Ç–∏–π –∑–Ω–∞–∫: —Ä–∞–∑–º–µ—Ä 70, —Å—Ä–µ–¥–Ω—è—è –ø—É–ª—å—Å–∞—Ü–∏—è (1600ms)

// –î–æ–±–∞–≤–ª—è–µ–º –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–µ –≤–µ—Ä—Å–∏–∏
map.addImage('exclamation-pulsing', exclamationPulsing, { pixelRatio: 2 });
map.addImage('energy-pulsing', energyPulsing, { pixelRatio: 2 });
map.addImage('thermometer-pulsing', thermometerPulsing, { pixelRatio: 2 });

// –°–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –∑–Ω–∞–∫–æ–≤
map.addSource('point-1', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63570024, 55.83845765]
                },
                'properties': {
                    'title': 'EMIIA.AI SIP <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4582]'
                }
            }
        ]
    }
});

map.addSource('point-2', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63572517,55.83859092]
                },
                'properties': {
                    'title': 'EMIIA.AI SIP <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4583]'
                }
            }
        ]
    }
});






map.addSource('point-3', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63572125,55.83852512]
                },
                'properties': {
                    'title': 'EMIIA.AI SIP: AI <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4584]'
                }
            }
        ]
    }
});





// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö –∑–Ω–∞–∫–æ–≤ —Å SVG –∏–∫–æ–Ω–∫–∞–º–∏
map.addLayer({
    'id': 'layer-1',
    'type': 'symbol',
    'source': 'point-1',
    'minzoom': 18,
    'layout': {
        'icon-image': 'exclamation-pulsing',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

map.addLayer({
    'id': 'layer-2',
    'type': 'symbol',
    'source': 'point-2',
    'minzoom': 18,
    'layout': {
        'icon-image': 'energy-pulsing',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

map.addLayer({
    'id': 'layer-3',
    'type': 'symbol',
    'source': 'point-3',
    'minzoom': 18,
    'layout': {
        'icon-image': 'thermometer-pulsing',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

// –°–æ–∑–¥–∞–µ–º popup –¥–ª—è –∑–Ω–∞–∫–æ–≤
const exclamationPopup = new mapboxgl.Popup({ 
    offset: 25,
    className: 'top-popup',
    maxWidth: '400px'
});

// HTML –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞–∫–∞
const redLinesHTML1 = `
<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color: #3d85c6; font-size: 14px; margin-bottom: 8px;">
        –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
    </div>
    <div style="color: #3d85c6; font-size: 14px;">
        <a href="https://www.emiia.ai/" 
           target="_blank" 
           style="color: #3d85c6; text-decoration: none;">
            –û–¢–ß–Å–¢ ‚ùØ
        </a>
    </div>
</div>
`;

// HTML –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∑–Ω–∞–∫–∞
const redLinesHTML2 = `
<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color: #3d85c6; font-size: 14px; margin-bottom: 8px;">
        –ü–µ—Ä–µ–≥—Ä–µ–≤ —ç–ª–µ–∫—Ç—Ä–æ–ø—Ä–æ–≤–æ–¥–∫–∏. 
    </div>
    <div style="color: #3d85c6; font-size: 14px;">
        <a href="https://www.emiia.ai/" 
           target="_blank" 
           style="color:#3d85c6; text-decoration: none;">
            –û–¢–ß–Å–¢ ‚ùØ
        </a>
    </div>
</div>
`;





// HTML –¥–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ –∑–Ω–∞–∫–∞
const redLinesHTML3 = `

<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">








<div style="font-family: 'Montserrat', sans-serif; font-size: 14px;">
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" fill="currentColor" class="bi bi-broadcast" viewBox="0 0 16 16">
      <path d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707m2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708m5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708m2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0"/>
    </svg>
    <div>
      –ü–ª–æ—Ç–Ω–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏ –≠–ú–ò (–ü–ü–≠): <br><span style="color: #383838; font-weight: 500;" id="RadioWaves">0.035</span> W/m¬≤<br> 
    </div>
  </div>
</div>









<div style="font-family: 'Montserrat', sans-serif; font-size: 14px;">
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-ear" viewBox="0 0 16 16">
  <path d="M8.5 1A4.5 4.5 0 0 0 4 5.5v7.047a2.453 2.453 0 0 0 4.75.861l.512-1.363a5.6 5.6 0 0 1 .816-1.46l2.008-2.581A4.34 4.34 0 0 0 8.66 1zM3 5.5A5.5 5.5 0 0 1 8.5 0h.16a5.34 5.34 0 0 1 4.215 8.618l-2.008 2.581a4.6 4.6 0 0 0-.67 1.197l-.51 1.363A3.453 3.453 0 0 1 3 12.547zM8.5 4A1.5 1.5 0 0 0 7 5.5v2.695q.168-.09.332-.192c.327-.208.577-.44.72-.727a.5.5 0 1 1 .895.448c-.256.513-.673.865-1.079 1.123A9 9 0 0 1 7 9.313V11.5a.5.5 0 0 1-1 0v-6a2.5 2.5 0 0 1 5 0V6a.5.5 0 0 1-1 0v-.5A1.5 1.5 0 0 0 8.5 4"/>
</svg>
    <div>
      –®—É–º: <br><span style="color: #383838; font-weight: 500;" id="noiseValue">44.49</span> dBA<br> 
    </div>
  </div>










<div style="font-family: 'Montserrat', sans-serif; font-size: 14px;">
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" fill="currentColor" class="bi bi-thermometer-high" viewBox="0 0 16 16">
      <path stroke="#dc3545" stroke-width="0.0" fill="#dc3545" d="M9.5 12.5a1.5 1.5 0 1 1-2-1.415V2.5a.5.5 0 0 1 1 0v8.585a1.5 1.5 0 0 1 1 1.415"/>
      <path stroke="#dc3545" stroke-width="0.0" fill="#dc3545" d="M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1"/>
    </svg>
    <div>
      –ù–∞—Ä—É—à–µ–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —Ä–µ–∂–∏–º <br><span style="color: #383838;
    font-weight: 500;">26.0 </span> ¬∞C<br> 
    </div>
  </div>









 <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-moisture" viewBox="0 0 16 16">
      <path stroke="#dc3545" stroke-width="0.0" fill="#dc3545" d="M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a29 29 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a29 29 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001zm0 0-.364-.343zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267"/>
    </svg>
    <div>
      –ù–∞—Ä—É—à–µ–Ω –º–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç <br> 
      <span style="color: #383838;
    font-weight: 500;">22.4 </span> % RH<br>         
          </div>
  </div>

  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-virus2" viewBox="0 0 16 16">
      <path stroke="#dc3545" stroke-width="0.0" fill="#dc3545" d="M8 0a1 1 0 0 0-1 1v1.143c0 .557-.407 1.025-.921 1.24-.514.214-1.12.162-1.513-.231l-.809-.809a1 1 0 1 0-1.414 1.414l.809.809c.394.394.445.999.23 1.513C3.169 6.593 2.7 7 2.144 7H1a1 1 0 0 0 0 2h1.143c.557 0 1.025.407 1.24.921.214.514.163 1.12-.231 1.513l-.809.809a1 1 0 0 0 1.414 1.414l.809-.809c.394-.394.999-.445 1.513-.23.514.214.921.682.921 1.24V15a1 1 0 1 0 2 0v-1.143c0-.557.407-1.025.921-1.24.514-.214 1.12-.162 1.513.231l.809.809a1 1 0 0 0 1.414-1.414l-.809-.809c-.393-.394-.445-.999-.23-1.513.214-.514.682-.921 1.24-.921H15a1 1 0 1 0 0-2h-1.143c-.557 0-1.025-.407-1.24-.921-.214-.514-.162-1.12.231-1.513l.809-.809a1 1 0 0 0-1.414-1.414l-.809.809c-.394.393-.999.445-1.513.23-.514-.214-.92-.682-.92-1.24V1a1 1 0 0 0-1-1Zm2 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0M7 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 5a1 1 0 1 1 0-2 1 1 0 0 1 0 2m4-4a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
    </svg>
    <div>
      –í—ã—è–≤–ª–µ–Ω—ã –∑–∞–≥—Ä—è–∑–Ω–∏—Ç–µ–ª–∏ –≤–æ–∑–¥—É—Ö–∞ <br> 
      VOC: <span id="vocValue" style="color: #383838;
    font-weight: 500;">257</span> ppm<br>         
      CO2: <span id="co2Value" style="color: #383838;
    font-weight: 500;">555</span> ppm
    </div>
  </div>

  <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color: #ff0000; font-size: 14px;">
      <a href="https://www.emiia.ai/" 
         target="_blank" 
         style="color: #3d85c6; text-decoration: none; display: flex; align-items: center; gap: 16px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" viewBox="0 0 16 16" style="flex-shrink: 0; display: block;">
          <path stroke="#dc3545" stroke-width="0.0" fill="#dc3545" d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V9H3V2a1 1 0 0 1 1-1h5.5v2zM3 12v-2h2v2H3zm0 1h2v2H4a1 1 0 0 1-1-1v-1zm3 2v-2h3v2H6zm4 0v-2h3v1a1 1 0 0 1-1 1h-2zm3-3h-3v-2h3v2zm-7 0v-2h3v2H6z"/>
        </svg>
        EMIIA.AI-–∞—É–¥–∏—Ç (–æ—Ç—á–µ—Ç) ‚ùØ
      </a>
    </div>
  </div>
</div>
</div>

`;




// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –∑–Ω–∞–∫–∞–º
map.on('click', 'layer-1', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + redLinesHTML1
        )
        .addTo(map);
});

map.on('click', 'layer-2', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + redLinesHTML2
        )
        .addTo(map);
});

map.on('click', 'layer-3', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + redLinesHTML3
        )
        .addTo(map);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫—É—Ä—Å–æ—Ä–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
map.on('mouseenter', 'layer-1', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-1', function() {
    map.getCanvas().style.cursor = '';
});

map.on('mouseenter', 'layer-2', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-2', function() {
    map.getCanvas().style.cursor = '';
});

map.on('mouseenter', 'layer-3', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-3', function() {
    map.getCanvas().style.cursor = '';
});






// === –î–û–ë–ê–í–õ–Ø–ï–ú –ü–û–°–õ–ï –°–£–©–ï–°–¢–í–£–Æ–©–ï–ì–û –ö–û–î–ê, –ù–ï –£–î–ê–õ–Ø–Ø –ï–ì–û ===

// SVG –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–µ—Ö –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–≤ (–∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ)
const newSVGIcon = `
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-octagon" viewBox="0 0 16 16">
  <path  fill="#FFba00" d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
  <path  fill="#FFba00" d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
</svg>
`;

// –°–æ–∑–¥–∞–µ–º –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–≤ (—Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è)
const newPulsing1 = createPulsingSVGIcon(newSVGIcon, 65, 1800);  // –ü–µ—Ä–≤—ã–π –Ω–æ–≤—ã–π –∑–Ω–∞–∫
const newPulsing2 = createPulsingSVGIcon(newSVGIcon, 60, 1500);  // –í—Ç–æ—Ä–æ–π –Ω–æ–≤—ã–π –∑–Ω–∞–∫  
const newPulsing3 = createPulsingSVGIcon(newSVGIcon, 70, 2000);  // –¢—Ä–µ—Ç–∏–π –Ω–æ–≤—ã–π –∑–Ω–∞–∫

// –î–æ–±–∞–≤–ª—è–µ–º –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–µ –≤–µ—Ä—Å–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–≤
map.addImage('new-pulsing-1', newPulsing1, { pixelRatio: 2 });
map.addImage('new-pulsing-2', newPulsing2, { pixelRatio: 2 });
map.addImage('new-pulsing-3', newPulsing3, { pixelRatio: 2 });

// –°–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–≤
map.addSource('point-4', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63538235, 55.83843804]
                },
                'properties': {
                    'title': 'EMIIA.AI SIP <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4585]'
                }
            }
        ]
    }
});

map.addSource('point-5', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63551940, 55.83840573]
                },
                'properties': {
                    'title': 'EMIIA.AI SIP <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4586]'
                }
            }
        ]
    }
});

map.addSource('point-6', {
    'type': 'geojson',
    'data': {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': [37.63612672, 55.83852930]
                },
                'properties': {
                    'title': 'EMIIA.AI SIP <br>DARK STORE #33',
                    'description': 'EMIIA.AI API: ID R: [#3D4587]'
                }
            }
        ]
    }
});

// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–≤
map.addLayer({
    'id': 'layer-4',
    'type': 'symbol',
    'source': 'point-4',
    'minzoom': 18,
    'layout': {
        'icon-image': 'new-pulsing-1',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

map.addLayer({
    'id': 'layer-5',
    'type': 'symbol',
    'source': 'point-5',
    'minzoom': 18,
    'layout': {
        'icon-image': 'new-pulsing-2',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

map.addLayer({
    'id': 'layer-6',
    'type': 'symbol',
    'source': 'point-6',
    'minzoom': 18,
    'layout': {
        'icon-image': 'new-pulsing-3',
        'icon-offset': [0, 0],
        'icon-allow-overlap': true,
        'icon-ignore-placement': true
    }
});

// HTML –¥–ª—è popup –≤—Å–µ—Ö —Ç—Ä–µ—Ö –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–≤ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ç–µ–∫—Å—Ç –∫–∞–∫ —É –ø–µ—Ä–≤–æ–≥–æ)
const newRedLinesHTML = `
<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
    <div style="color:  #3d85c6; font-size: 14px; margin-bottom: 8px;">
        –ò—Å—Ç–µ–∫–∞–µ—Ç —Å—Ä–æ–∫ –∑–∞–º–µ–Ω—ã –æ–≥–Ω–µ—Ç—É—à–∏—Ç–µ–ª—è.
    </div>
    <div style="color:  #3d85c6; font-size: 14px;">
        <a href="https://www.emiia.ai/" 
           target="_blank" 
           style="color:  #3d85c6; text-decoration: none;">
            –û–¢–ß–Å–¢ ‚ùØ
        </a>
    </div>
</div>
`;

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –Ω–æ–≤—ã–º –∑–Ω–∞–∫–∞–º
map.on('click', 'layer-4', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + newRedLinesHTML
        )
        .addTo(map);
});

map.on('click', 'layer-5', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + newRedLinesHTML
        )
        .addTo(map);
});

map.on('click', 'layer-6', function(e) {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const description = e.features[0].properties.description;
    const title = e.features[0].properties.title;
    
    exclamationPopup
        .setLngLat(coordinates)
        .setHTML(
            '<h3>' + title + '</h3><p>' + description + '</p>' + newRedLinesHTML
        )
        .addTo(map);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫—É—Ä—Å–æ—Ä–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –Ω–æ–≤—ã–µ –∑–Ω–∞–∫–∏
map.on('mouseenter', 'layer-4', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-4', function() {
    map.getCanvas().style.cursor = '';
});

map.on('mouseenter', 'layer-5', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-5', function() {
    map.getCanvas().style.cursor = '';
});

map.on('mouseenter', 'layer-6', function() {
    map.getCanvas().style.cursor = 'pointer';
});

map.on('mouseleave', 'layer-6', function() {
    map.getCanvas().style.cursor = '';
});


















const size = 180;

// –ü–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞ (–∑–µ–ª–µ–Ω–∞—è) - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è
const pulsingDot = {
    width: size,
    height: size,
    data: new Uint8Array(size * size * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const duration = 1800;
        const pulseDuration = 700;
        const t = (performance.now() % duration) / duration;
        const pulseT = (performance.now() % pulseDuration) / pulseDuration;
        const context = this.context;

        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const maxRadius = size / 2 * 1;
        const sweepAngle = Math.PI * 2 * 1.7 * t;
        const opacity = 0.8 * Math.pow(1 - t, 2);

        context.beginPath();
        context.moveTo(centerX, centerY);
        context.arc(centerX, centerY, maxRadius, Math.PI / 2, sweepAngle + Math.PI / 2);
        context.closePath();

        context.fillStyle = `rgba(45, 190, 100, ${opacity})`;
        context.fill();

        const radius = (size / 2) * 0.35;
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = 'rgba(144, 238, 144, 1)';
        context.strokeStyle = '#f8f9fa';

        context.lineWidth = 4 + 4 * Math.abs(Math.sin(Math.PI * pulseT));
        context.fill();
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        map.triggerRepaint();

        return true;
    }
};

// –í—Ç–æ—Ä–∞—è —Ç–æ—á–∫–∞ (–æ—Ä–∞–Ω–∂–µ–≤–∞—è)
const pulsingDotOrange = {
    width: size,
    height: size,
    data: new Uint8Array(size * size * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const duration = 1500;
        const pulseDuration = 700;
        const t = (performance.now() % duration) / duration;
        const pulseT = (performance.now() % pulseDuration) / pulseDuration;
        const context = this.context;

        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const maxRadius = size / 2 * 1;
        const sweepAngle = Math.PI * 2 * 1.7 * t;
        const opacity = 0.8 * Math.pow(1 - t, 2);

        context.beginPath();
        context.moveTo(centerX, centerY);
        context.arc(centerX, centerY, maxRadius, Math.PI / 2, sweepAngle + Math.PI / 2);
        context.closePath();

        context.fillStyle = `rgba(255, 165, 0, ${opacity})`; // –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç
        context.fill();

        const radius = (size / 2) * 0.35;
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = 'rgba(255, 200, 100, 1)'; // –°–≤–µ—Ç–ª–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π
        context.strokeStyle = '#f8f9fa';

        context.lineWidth = 4 + 4 * Math.abs(Math.sin(Math.PI * pulseT));
        context.fill();
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        map.triggerRepaint();

        return true;
    }
};

// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∫—Ä–∞—Å–Ω–æ–π —Ç–æ—á–∫–∏ (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞)
const redDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 15;

        // –í–Ω–µ—à–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ
        const gradient = context.createRadialGradient(centerX, centerY, radius, centerX, centerY, radius + 5);
        gradient.addColorStop(0, 'rgba(255, 0, 0, 0.8)');
        gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');

        context.beginPath();
        context.arc(centerX, centerY, radius + 5, 0, Math.PI * 2);
        context.fillStyle = gradient;
        context.fill();

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#e06666';
        context.fill();

        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 3;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ä–∞–Ω–∂–µ–≤–æ–π —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
const orangeDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 15;

        // –í–Ω–µ—à–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ
        const gradient = context.createRadialGradient(centerX, centerY, radius, centerX, centerY, radius + 5);
        gradient.addColorStop(0, 'rgba(255, 165, 0, 0.8)'); // –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç
        gradient.addColorStop(1, 'rgba(255, 165, 0, 0)');

        context.beginPath();
        context.arc(centerX, centerY, radius + 5, 0, Math.PI * 2);
        context.fillStyle = gradient;
        context.fill();

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#ffa500'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
        context.fill();

        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 3;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–µ—Ä–æ–π —Ç–æ—á–∫–∏ (–ø—Ä–æ–π–¥–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞)
const grayDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 12;

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#b9ea21';
        context.fill();

        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 2;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–µ—Ä–æ–π –æ—Ä–∞–Ω–∂–µ–≤–æ–π —Ç–æ—á–∫–∏ (–ø—Ä–æ–π–¥–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ä–∞–Ω–∂–µ–≤–æ–π —Ç–æ—á–∫–∏)
const grayOrangeDot = {
    width: 40,
    height: 40,
    data: new Uint8Array(40 * 40 * 4),

    onAdd: function () {
        const canvas = document.createElement('canvas');
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext('2d', { willReadFrequently: true });
    },

    render: function () {
        const context = this.context;
        context.clearRect(0, 0, this.width, this.height);

        const centerX = this.width / 2;
        const centerY = this.height / 2;
        const radius = 12;

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.fillStyle = '#cccc00'; // –ñ–µ–ª—Ç–æ-—Å–µ—Ä—ã–π –¥–ª—è –æ—Ä–∞–Ω–∂–µ–≤–æ–π —Ç–æ—á–∫–∏
        context.fill();

        // –ë–µ–ª–∞—è –æ–±–≤–æ–¥–∫–∞
        context.beginPath();
        context.arc(centerX, centerY, radius, 0, Math.PI * 2);
        context.strokeStyle = '#ffffff';
        context.lineWidth = 2;
        context.stroke();

        this.data = context.getImageData(0, 0, this.width, this.height).data;
        return true;
    }
};

// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏ (–∑–µ–ª–µ–Ω–∞—è)
const coordinates1 = [
    [37.63585261,55.83839169],
    [37.63583652,55.83837213],
    [37.63594252,55.83834578],
    [37.63598143,55.8383977],
    [37.63563796,55.83848348], // –ß–ï–¢–í–ï–†–¢–ê–Ø
    [37.63556925,55.83850933],
    [37.63559508,55.83854435],
    [37.63564159,55.83860005],
    [37.63585585,55.83854527],
    [37.63605058,55.83849579],
    [37.63598143,55.8383977],
    [37.63594252,55.83834578],
    [37.63585261,55.83839169]
];

// –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏ (–æ—Ä–∞–Ω–∂–µ–≤–∞—è)
const coordinates2 = [
    [37.63573089, 55.83832215],
    [37.63543959, 55.83839318],
    [37.63551033, 55.83847803], // –¢–û–ß–ö–ê –û–°–¢–ê–ù–û–í–ö–ò (–∏–Ω–¥–µ–∫—Å 2)
    [37.63553685,55.83851043], // –¢–û–ß–ö–ê –ò–ó–ì–ò–ë–ê
    [37.63563796,55.83848348], // –¢–û–ß–ö–ê –¢–û–í–ê–†–ê –ò –û–°–¢–ê–ù–û–í–ö–ò (–∏–Ω–¥–µ–∫—Å 4)
    [37.63553685,55.83851043], // –¢–û–ß–ö–ê –ò–ó–ì–ò–ë–ê
    [37.63543959, 55.83839318],
    [37.63573089, 55.83832215]
];

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –¥–ª—è –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
const stopPoints1 = [4, 8];
const finalDestination1 = coordinates1.length - 1;

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ—á–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏ (–¥–≤–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏)
const stopPoints2 = [2, 4]; // –û—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ 2-–π –∏ 4-–π —Ç–æ—á–∫–∞—Ö
const finalDestination2 = coordinates2.length - 1;

// –ú–∞—Å—Å–∏–≤—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
const completedStops1 = new Set();
const completedStops2 = new Set();

// –¢–µ–∫—É—â–∏–µ —Ü–µ–ª–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
let currentTargetIndex1 = 0;
let currentTargetIndex2 = 0;

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Ü–µ–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞
function getNextTarget1() {
    for (let stop of stopPoints1) {
        if (!completedStops1.has(stop)) {
            return stop;
        }
    }
    return finalDestination1;
}

function getNextTarget2() {
    for (let stop of stopPoints2) {
        if (!completedStops2.has(stop)) {
            return stop;
        }
    }
    return finalDestination2;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –¥–ª—è –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
function resetStopPoints1() {
    completedStops1.clear();
    currentTargetIndex1 = getNextTarget1();
    
    const stopFeatures = stopPoints1.map(index => ({
        'type': 'Feature',
        'geometry': {
            'type': 'Point',
            'coordinates': coordinates1[index]
        },
        'properties': {
            'index': index,
            'isCompleted': false
        }
    }));
    
    map.getSource('stop-points-1').setData({
        'type': 'FeatureCollection',
        'features': stopFeatures
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏
function resetStopPoints2() {
    completedStops2.clear();
    currentTargetIndex2 = getNextTarget2();
    
    const stopFeatures = stopPoints2.map(index => ({
        'type': 'Feature',
        'geometry': {
            'type': 'Point',
            'coordinates': coordinates2[index]
        },
        'properties': {
            'index': index,
            'isCompleted': false
        }
    }));
    
    map.getSource('stop-points-2').setData({
        'type': 'FeatureCollection',
        'features': stopFeatures
    });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–æ–µ–≤ —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
function refreshStopPointsLayer1() {
    if (window.svgLayersHidden) {
    map.setPaintProperty('stop-points-layer-1', 'icon-opacity', 0);
    map.setLayoutProperty('stop-points-layer-1', 'visibility', 'none');
}
    
    map.addLayer({
        'id': 'stop-points-layer-1',
        'type': 'symbol',
        'source': 'stop-points-1',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'layer-with-pulsing-dot-1');
}

function refreshStopPointsLayer2() {
    if (window.svgLayersHidden) {
    map.setPaintProperty('stop-points-layer-2', 'icon-opacity', 0);
    map.setLayoutProperty('stop-points-layer-2', 'visibility', 'none');
}



    
    map.addLayer({
        'id': 'stop-points-layer-2',
        'type': 'symbol',
        'source': 'stop-points-2',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'layer-with-pulsing-dot-2');
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö ISS –∏ popup
async function fetchISSData() {
    try {
        const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö ISS:', error);
        return null;
    }
}

function getCurrentDate() {
    return new Date().toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
    });
}

function formatISSData(issData) {
    if (!issData) return '<div class="error">–î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã</div>';
    
    return `
        <div class="iss-data">
            <h3>Dark Store: #33</h3>
            <div class="data-grid">
                <div class="data-item">
                    <strong>–®–∏—Ä–æ—Ç–∞:</strong> ${issData.latitude ? issData.latitude.toFixed(4) : 'N/A'}¬∞
                </div>
                <div class="data-item">
                    <strong>–î–æ–ª–≥–æ—Ç–∞:</strong> ${issData.longitude ? issData.longitude.toFixed(4) : 'N/A'}¬∞
                </div>
                <div class="data-item">
                    <strong>–í—ã—Å–æ—Ç–∞:</strong> ${issData.altitude ? '1' + issData.altitude.toFixed(2) : 'N/A'} —Å–º
                </div>
                <div class="data-item">
                    <strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> ${issData.velocity ? issData.velocity.toFixed(2).replace(/(\d)(?=\d{4,})/, '$1,').replace('.', ',') : 'N/A'} –∫–º/—á
                </div>
                <div class="data-item">
                    <strong>–í–∏–¥–∏–º–æ—Å—Ç—å:</strong> ${issData.visibility || 'N/A'}
                </div>
                <div class="data-item">
                    <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> ${new Date().toLocaleTimeString('ru-RU') + '.' + new Date().getMilliseconds().toString().padStart(3, '0')}
                </div>
                <div class="data-item">
                    <strong>–î–∞—Ç–∞:</strong> ${getCurrentDate()}
                </div>
            </div>
            <div class="update-info">
                –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 ms
            </div>
        </div>
    `;
}

// –°–æ–∑–¥–∞–µ–º popup –¥–ª—è —Ç–æ—á–µ–∫
let pointPopup1 = null;
let pointPopup2 = null;
let updateInterval1 = null;
let updateInterval2 = null;

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ popup
async function updatePopupData1() {
    const issData = await fetchISSData();
    if (pointPopup1 && pointPopup1.isOpen()) {
        pointPopup1.setHTML(`
            <div class="popup-content">
                <h3>EMIIA.AI SIP: API DATASET <br>–°–æ—Ç—Ä—É–¥–Ω–∏–∫: ID D [#353837]</h3>
                <p>EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ EMIIA.AI SIP: ID R: [#3D4581]</p>
                ${formatISSData(issData)}
            </div>
        `);
    }
}

async function updatePopupData2() {
    const issData = await fetchISSData();
    if (pointPopup2 && pointPopup2.isOpen()) {
        pointPopup2.setHTML(`
            <div class="popup-content">
                <h3>EMIIA.AI SIP: API DATASET <br>–†–æ–±–æ—Ç: ID D [#309945]</h3>
                <p>EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ EMIIA.AI SIP: ID R: [#FFA500]</p>
                ${formatISSData(issData)}
            </div>
        `);
    }
}

map.on('load', () => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 3D-–Ω–∞–∫–ª–æ–Ω –∫–∞—Ä—Ç—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–æ–¥–Ω—è—Ç–∏—è
    map.setPitch(45);
    map.setBearing(0);

    // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –ü–†–û–ô–î–ï–ù–ù–û–ì–û –ø—É—Ç–∏ (—Å–µ—Ä—ã–π) –¥–ª—è –æ–±–µ–∏—Ö —Ç–æ—á–µ–∫
    map.addSource('passed-route-1', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    map.addSource('passed-route-2', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –ü–†–ï–î–°–¢–û–Ø–©–ï–ì–û –ø—É—Ç–∏ (–∑–µ–ª–µ–Ω—ã–π) –¥–ª—è –æ–±–µ–∏—Ö —Ç–æ—á–µ–∫
    map.addSource('future-route-1', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    map.addSource('future-route-2', {
        'type': 'geojson',
        'data': {
            'type': 'Feature',
            'geometry': {
                'type': 'LineString',
                'coordinates': []
            }
        }
    });

    // –°–ù–ê–ß–ê–õ–ê –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏ (—Å–µ—Ä—ã–π)
    map.addLayer({
        'id': 'passed-route-line-1',
        'type': 'line',
        'source': 'passed-route-1',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#9ae894',
            'line-width': 8,
            'line-opacity': 0.3
        }
    }, '3d-buildings');

    map.addLayer({
        'id': 'passed-route-line-2',
        'type': 'line',
        'source': 'passed-route-2',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#ffb366',
            'line-width': 8,
            'line-opacity': 0.2
        }
    }, 'passed-route-line-1');

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–≥–æ –ø—É—Ç–∏ (–∑–µ–ª–µ–Ω—ã–π –∏ –æ—Ä–∞–Ω–∂–µ–≤—ã–π)
    map.addLayer({
        'id': 'future-route-line-1',
        'type': 'line',
        'source': 'future-route-1',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#9ae894',
            'line-width': 8,
            'line-opacity': 1
        }
    }, 'passed-route-line-2');

    map.addLayer({
        'id': 'future-route-line-2',
        'type': 'line',
        'source': 'future-route-2',
        'minzoom': 20,
        'layout': {
            'line-join': 'round',
            'line-cap': 'round'
        },
        'paint': {
            'line-color': '#ffb366', // –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤—Ç–æ—Ä–æ–π –ª–∏–Ω–∏–∏
            'line-width': 8,
            'line-opacity': 1
        }
    }, 'future-route-line-1');

    // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ—á–µ–∫
    map.addImage('pulsing-dot', pulsingDot, { pixelRatio: 4 });
    map.addImage('pulsing-dot-orange', pulsingDotOrange, { pixelRatio: 4 });
    map.addImage('red-dot', redDot, { pixelRatio: 2 });
    map.addImage('orange-dot', orangeDot, { pixelRatio: 2 });
    map.addImage('gray-dot', grayDot, { pixelRatio: 2 });
    map.addImage('gray-orange-dot', grayOrangeDot, { pixelRatio: 2 });

    // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ—á–µ–∫
    map.addSource('dot-point-1', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates1[0]
                    }
                }
            ]
        }
    });

    map.addSource('dot-point-2', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': [
                {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates2[0]
                    }
                }
            ]
        }
    });

    // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
    map.addSource('stop-points-1', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': stopPoints1.map(index => ({
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': coordinates1[index]
                },
                'properties': {
                    'index': index,
                    'isCompleted': false
                }
            }))
        }
    });

    map.addSource('stop-points-2', {
        'type': 'geojson',
        'data': {
            'type': 'FeatureCollection',
            'features': stopPoints2.map(index => ({
                'type': 'Feature',
                'geometry': {
                    'type': 'Point',
                    'coordinates': coordinates2[index]
                },
                'properties': {
                    'index': index,
                    'isCompleted': false
                }
            }))
        }
    });

    // –°–ù–ê–ß–ê–õ–ê –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
    map.addLayer({
        'id': 'stop-points-layer-1',
        'type': 'symbol',
        'source': 'stop-points-1',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, '3d-buildings');

    map.addLayer({
        'id': 'stop-points-layer-2',
        'type': 'symbol',
        'source': 'stop-points-2',
        'minzoom': 20,
        'layout': {
            'icon-image': ['case',
                ['==', ['get', 'isCompleted'], true], 'gray-dot',
                'red-dot'
            ],
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'stop-points-layer-1');

    // –ü–û–¢–û–ú –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —Ç–æ—á–µ–∫
    map.addLayer({
        'id': 'layer-with-pulsing-dot-1',
        'type': 'symbol',
        'source': 'dot-point-1',
        'minzoom': 18,
        'layout': {
            'icon-image': 'pulsing-dot',
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'stop-points-layer-2');

    map.addLayer({
        'id': 'layer-with-pulsing-dot-2',
        'type': 'symbol',
        'source': 'dot-point-2',
        'minzoom': 18,
        'layout': {
            'icon-image': 'pulsing-dot-orange',
            'icon-offset': [0, 0],
            'icon-allow-overlap': true,
            'icon-ignore-placement': true
        }
    }, 'layer-with-pulsing-dot-1');

    // –°–æ–∑–¥–∞–µ–º popup –¥–ª—è —Ç–æ—á–µ–∫
    pointPopup1 = new mapboxgl.Popup({ 
        offset: 25,
        className: 'top-popup',
        maxWidth: '400px'
    });

    pointPopup2 = new mapboxgl.Popup({ 
        offset: 25,
        className: 'top-popup',
        maxWidth: '400px'
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –¥–≤–∏–∂—É—â–∏–º—Å—è —Ç–æ—á–∫–∞–º
    map.on('click', 'layer-with-pulsing-dot-1', function(e) {
        const coordinates = e.features[0].geometry.coordinates.slice();
        
        updatePopupData1();
        updateInterval1 = setInterval(updatePopupData1, 500);
        
        pointPopup1
            .setLngLat(coordinates)
            .setHTML(`
                <div class="popup-content">
                    <h3>EMIIA.AI SIP: API DATASET <br> –°–æ—Ç—Ä—É–¥–Ω–∏–∫:</h3>
                    <p>EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ EMIIA.AI SIP: ID R: [#3D4581]</p>
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö EMIIA.AI SIP: API...</div>
                </div>
            `)
            .addTo(map);
    });

    map.on('click', 'layer-with-pulsing-dot-2', function(e) {
        const coordinates = e.features[0].geometry.coordinates.slice();
        
        updatePopupData2();
        updateInterval2 = setInterval(updatePopupData2, 500);
        
        pointPopup2
            .setLngLat(coordinates)
            .setHTML(`
                <div class="popup-content">
                    <h3>EMIIA.AI SIP: API DATASET <br> –†–æ–±–æ—Ç:</h3>
                    <p>EMIIA.AI API: JSON DATASET OUTPUT ‚ùØ EMIIA.AI SIP: ID R: [#FFA500]</p>
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö EMIIA.AI SIP: API...</div>
                </div>
            `)
            .addTo(map);
    });

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ popup
    pointPopup1.on('close', function() {
        if (updateInterval1) {
            clearInterval(updateInterval1);
            updateInterval1 = null;
        }
    });

    pointPopup2.on('close', function() {
        if (updateInterval2) {
            clearInterval(updateInterval2);
            updateInterval2 = null;
        }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–µ —Ü–µ–ª–∏
    currentTargetIndex1 = getNextTarget1();
    currentTargetIndex2 = getNextTarget2();







    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–æ—á–µ–∫ –∏ –ª–∏–Ω–∏–π
    let currentIndex1 = 0;
    let currentIndex2 = 0;
    const duration = 8000;

    function animatePoint1() {
        const nextIndex = (currentIndex1 + 1) % coordinates1.length;
        const startCoord = coordinates1[currentIndex1];
        const endCoord = coordinates1[nextIndex];
        const startTime = performance.now();

        if (nextIndex === 0) {
            resetStopPoints1();
            setTimeout(refreshStopPointsLayer1, 100);
        }

        function animate(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const lng = startCoord[0] + (endCoord[0] - startCoord[0]) * progress;
            const lat = startCoord[1] + (endCoord[1] - startCoord[1]) * progress;
            const currentPoint = [lng, lat];
            
            // –°–ù–ê–ß–ê–õ–ê –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–∫—É (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ú–ï–î–õ–ï–ù–ù–ï–ï –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º)
            map.getSource('dot-point-1').setData({
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': currentPoint
                        }
                    }
                ]
            });

            // –ú–∏–∫—Ä–æ-–∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            setTimeout(() => {
                // –ü–û–¢–û–ú –æ–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ (—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –ë–´–°–¢–†–ï–ï)
                const passedCoords = coordinates1.slice(0, currentIndex1 + 1);
                passedCoords.push(currentPoint);
                
                const futureCoords = [currentPoint];
                let targetReached = false;
                
                for (let i = currentIndex1 + 1; i < coordinates1.length && !targetReached; i++) {
                    futureCoords.push(coordinates1[i]);
                    if (i === currentTargetIndex1) targetReached = true;
                }
                
                if (!targetReached) {
                    for (let i = 0; i <= currentTargetIndex1 && !targetReached; i++) {
                        futureCoords.push(coordinates1[i]);
                        if (i === currentTargetIndex1) targetReached = true;
                    }
                }
                
                map.getSource('passed-route-1').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': passedCoords
                    }
                });
                
                map.getSource('future-route-1').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': futureCoords
                    }
                });

                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏–º —Ä–µ—Ä–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç—ã
                map.triggerRepaint();
            }, 16); // ~1 –∫–∞–¥—Ä

            if (stopPoints1.includes(currentIndex1) && !completedStops1.has(currentIndex1)) {
                completedStops1.add(currentIndex1);
                currentTargetIndex1 = getNextTarget1();
                
                const stopFeatures = stopPoints1.map(index => ({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates1[index]
                    },
                    'properties': {
                        'index': index,
                        'isCompleted': completedStops1.has(index)
                    }
                }));
                
                map.getSource('stop-points-1').setData({
                    'type': 'FeatureCollection',
                    'features': stopFeatures
                });

                setTimeout(refreshStopPointsLayer1, 50);
            }

            if (pointPopup1 && pointPopup1.isOpen()) {
                pointPopup1.setLngLat(currentPoint);
            }

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                currentIndex1 = nextIndex;
                setTimeout(() => {
                    requestAnimationFrame(animatePoint1);
                }, 500);
            }
        }

        requestAnimationFrame(animate);
    }

    function animatePoint2() {
        const nextIndex = (currentIndex2 + 1) % coordinates2.length;
        const startCoord = coordinates2[currentIndex2];
        const endCoord = coordinates2[nextIndex];
        const startTime = performance.now();

        if (nextIndex === 0) {
            resetStopPoints2();
            setTimeout(refreshStopPointsLayer2, 100);
        }

        function animate(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const lng = startCoord[0] + (endCoord[0] - startCoord[0]) * progress;
            const lat = startCoord[1] + (endCoord[1] - startCoord[1]) * progress;
            const currentPoint = [lng, lat];
            
            // –°–ù–ê–ß–ê–õ–ê –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ—á–∫—É (—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ú–ï–î–õ–ï–ù–ù–ï–ï –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º)
            map.getSource('dot-point-2').setData({
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': currentPoint
                        }
                    }
                ]
            });

            // –ú–∏–∫—Ä–æ-–∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            setTimeout(() => {
                // –ü–û–¢–û–ú –æ–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ (—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –ë–´–°–¢–†–ï–ï)
                const passedCoords = coordinates2.slice(0, currentIndex2 + 1);
                passedCoords.push(currentPoint);
                
                const futureCoords = [currentPoint];
                let targetReached = false;
                
                for (let i = currentIndex2 + 1; i < coordinates2.length && !targetReached; i++) {
                    futureCoords.push(coordinates2[i]);
                    if (i === currentTargetIndex2) targetReached = true;
                }
                
                if (!targetReached) {
                    for (let i = 0; i <= currentTargetIndex2 && !targetReached; i++) {
                        futureCoords.push(coordinates2[i]);
                        if (i === currentTargetIndex2) targetReached = true;
                    }
                }
                
                map.getSource('passed-route-2').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': passedCoords
                    }
                });
                
                map.getSource('future-route-2').setData({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'LineString',
                        'coordinates': futureCoords
                    }
                });

                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏–º —Ä–µ—Ä–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç—ã
                map.triggerRepaint();
            }, 16); // ~1 –∫–∞–¥—Ä

            if (stopPoints2.includes(currentIndex2) && !completedStops2.has(currentIndex2)) {
                completedStops2.add(currentIndex2);
                currentTargetIndex2 = getNextTarget2();
                
                const stopFeatures = stopPoints2.map(index => ({
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': coordinates2[index]
                    },
                    'properties': {
                        'index': index,
                        'isCompleted': completedStops2.has(index)
                    }
                }));
                
                map.getSource('stop-points-2').setData({
                    'type': 'FeatureCollection',
                    'features': stopFeatures
                });

                setTimeout(refreshStopPointsLayer2, 50);
            }

            if (pointPopup2 && pointPopup2.isOpen()) {
                pointPopup2.setLngLat(currentPoint);
            }

            if (progress < 1) {
                requestAnimationFrame(animate);
            } else {
                currentIndex2 = nextIndex;
                setTimeout(() => {
                    requestAnimationFrame(animatePoint2);
                }, 500);
            }
        }

        requestAnimationFrame(animate);
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ–±–µ–∏—Ö —Ç–æ—á–µ–∫
    setTimeout(() => {
        requestAnimationFrame(animatePoint1);
    }, 6000);
    
    setTimeout(() => {
        requestAnimationFrame(animatePoint2);
    }, 1000);
});








// –î–æ–±–∞–≤–ª—è–µ–º –ø—è—Ç–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ GLB-—Ñ–∞–π–ª–∞ –ª–∞—Å—Ç–æ—á–∫–∞-—Ç–µ—Å—Ç
        map.addSource('model5', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'properties': {
                    'model-uri':
                        ''
                },
                'geometry': {
                    'coordinates': [37.631367826980494,
            55.833906458903954],
                    'type': 'Point'
                }
            }
        });


        // add the clip layer and configure it to also remove symbols and trees.
        // clip-layer-scope layout property is used to specify that only models from the Mapbox Standard Style should be clipped.
        // this will prevent the newly added model from getting clipped.
        map.addLayer({
            'id': 'eraser',
            'type': 'clip',
            'source': 'eraser',
            'layout': {
                // specify the layer types to be removed by this clip layer
                'clip-layer-types': ['symbol', 'model'],
                'clip-layer-scope': ['basemap']
            }
        });

        // add the model layer and specify the appropriate slot to ensure the symbols are rendered correctly.
        



    map.addLayer({
        'id': 'tower5',
        'type': 'model',
        'slot': 'middle',
        'source': 'model5',
        'minzoom': 15,
        'maxzoom': 21,
        'layout': {
            'model-id': ['get', 'model-uri']
        },
        'paint': {
            'model-opacity': ['interpolate', ['linear'], ['zoom'], 15, 1, 21, 0],
            'model-rotation': [0.0, 0.0, 4.0],
            'model-scale': [1.5, 1.5, 1.5],
'model-translation': [0, 0, 4], // –ó–î–ï–°–¨: –ø–æ–¥–Ω—è—Ç–∏–µ –Ω–∞ 10 –µ–¥–∏–Ω–∏—Ü –ø–æ Z
            'model-color-mix-intensity': 0,
            'model-cast-shadows': true,

            'model-emissive-strength': 0.3
        }
    });


















// –î–æ–±–∞–≤–ª—è–µ–º —á–µ—Ç–≤–µ—Ä—Ç—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ GLB-—Ñ–∞–π–ª–∞ –Ω–∏–∂–Ω–∏–π
map.addSource('model4', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_verh_GLB.glb' // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤—Ç–æ—Ä–æ–≥–æ GLB
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094], // –î—Ä—É–≥–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower4',
    'type': 'model',
    'slot': 'middle',
    'source': 'model4',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],



17, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18, 0.1, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
18.5, 0.9, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            19, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 1  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5



    
        ],
        




        'model-rotation': [0.0, 0.0, -761.5],
      


'model-scale': [999.5, 1090.0, 1000],

        'model-translation': [0, 0, 0.001], // –ó–î–ï–°–¨: –ø–æ–¥–Ω—è—Ç–∏–µ –Ω–∞ 10 –µ–¥–∏–Ω–∏—Ü –ø–æ Z
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,


        'model-emissive-strength': 0.9



    }
});



























// –î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ GLB-—Ñ–∞–π–ª–∞ –≤–µ—Ä—Ö–Ω–∏–π
map.addSource('model2', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_verh_GLB.glb' // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤—Ç–æ—Ä–æ–≥–æ GLB
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094], // –î—Ä—É–≥–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower2',
    'type': 'model',
    'slot': 'middle',
    'source': 'model2',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },



    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],
            17, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18, 0.1, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
18.5, 0.9, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            19, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 1  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
        ],

        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 100],
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 6.3],
        'model-emissive-strength': 0.9



    }
});

























// –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ GeoJSON —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –∑–µ–ª–µ–Ω–∞—è –º–æ–¥–µ–ª—å
map.addSource('model1', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_MINUS_GLB_TEST.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π –º–æ–¥–µ–ª–∏ —Å –ø–ª–∞–≤–Ω—ã–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
map.addLayer({
    'id': 'tower1',
    'type': 'model',
    'slot': 'middle',
    'source': 'model1',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18.5, 0.5, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            18.6, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 0.8  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.3],
        'model-emissive-strength': 0.99
    }
});










// –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ GeoJSON —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –ó–ù–ê–ö–ò –ü–û–ñ–ê–†–ù–´–ï
map.addSource('model7', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_BASE_GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π –º–æ–¥–µ–ª–∏ —Å –ø–ª–∞–≤–Ω—ã–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
map.addLayer({
    'id': 'tower7',
    'type': 'model',
    'slot': 'middle',
    'source': 'model7',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18.5, 0.4, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            18.6, 0.5,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
20, 0.8,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
21, 0.9,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
22, 0.9,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
24, 0.9  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});













// –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ GeoJSON —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –ó–ù–ê–ö–ò –ü–û–ñ–ê–†–ù–´–ï –°–¢–ê–¢–£–° (–ü–û–õ–û–ú–ö–ê, –ó–ê–ú–ï–ù–ê...)
map.addSource('model8', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH_FARE_1_GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π –º–æ–¥–µ–ª–∏ —Å –ø–ª–∞–≤–Ω—ã–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
map.addLayer({
    'id': 'tower8',
    'type': 'model',
    'slot': 'middle',
    'source': 'model8',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18.5, 0.4, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            18.6, 0.5,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
20, 0.8,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
21, 0.9,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
22, 0.9,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
24, 0.9  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});
















// –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ GeoJSON —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –≥–ª–∞–≤–Ω–∞—è –º–æ–¥–µ–ª—å
map.addSource('model', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VDNH-GLB.glb'
        },
        'geometry': {
            'coordinates': [37.63113790199057,
          55.834227583210094],
            'type': 'Point'
        }
    }
});


// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π –º–æ–¥–µ–ª–∏ —Å –ø–ª–∞–≤–Ω—ã–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
map.addLayer({
    'id': 'tower',
    'type': 'model',
    'slot': 'middle',
    'source': 'model',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


            18.3, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18.5, 0.4, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            18.6, 0.5,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
20, 0.8,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
21, 0.9,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
22, 0.9,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
24, 0.9  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5


        ],


        'model-rotation': [0.0, 0.0, -761.5],
        'model-scale': [999.5, 1090.0, 1000],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.2],
        'model-emissive-strength': 0.99
    }
});







































// –î–æ–±–∞–≤–ª—è–µ–º —á–µ—Ç–≤–µ—Ä—Ç—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ GLB-—Ñ–∞–π–ª–∞ –Ω–∏–∂–Ω–∏–π –í–∫—É—Å–í–∏–ª–ª –Ω–∏–∂–Ω–∏–π
map.addSource('model22', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_VERH_GLB.glb' // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤—Ç–æ—Ä–æ–≥–æ GLB
        },
        'geometry': {
           'coordinates': [37.6357745,55.8383770], // –î—Ä—É–≥–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower22',
    'type': 'model',
    'slot': 'middle',
    'source': 'model22',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],



17, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18, 0.1, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
18.5, 0.9, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            19, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 1  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5



    
        ],
        




        





'model-rotation': [0, 0.0, -155.8],
        'model-scale': [1215.5, 1120.0, 1170],




        'model-translation': [0, 0, -0.1], // –ó–î–ï–°–¨: –ø–æ–¥–Ω—è—Ç–∏–µ –Ω–∞ 10 –µ–¥–∏–Ω–∏—Ü –ø–æ Z
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,


        'model-emissive-strength': 0.9



    }
});




















// –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ GeoJSON —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –í–ö–£–°–í–ò–õ–õ —Ç–æ–≤–∞—Ä
map.addSource('model23', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_ZONE_GLB.gl'
        },
        'geometry': {
            'coordinates': [37.6357745,55.8383770],
            'type': 'Point'
        }
    }
});


// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π –º–æ–¥–µ–ª–∏ —Å –ø–ª–∞–≤–Ω—ã–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
map.addLayer({
    'id': 'tower23',
    'type': 'model',
    'slot': 'middle',
    'source': 'model23',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {

 'model-color': '#ffffff', // –ë–µ–ª—ã–π —Ü–≤–µ—Ç –º–æ–¥–µ–ª–∏
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


        18.3, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18.5, 0.4, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            18.6, 0.5,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
20, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
21, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
22, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
24, 1  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5



        ],


        'model-rotation': [00, 0.0, -155.8],
        'model-scale': [1215.5, 1120.0, 1170],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, -0.1],
        'model-emissive-strength': 0.9
    }
});




















// –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ GeoJSON —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ –í–ö–£–°–í–ò–õ–õ –ë–ê–ó–ê
map.addSource('model20', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://www.emiia.ru/vv/rezervnaja_copy_glb.glb'
        },
        'geometry': {
            'coordinates': [37.6357745,55.8383770],
            'type': 'Point'
        }
    }
});


// –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π –º–æ–¥–µ–ª–∏ —Å –ø–ª–∞–≤–Ω—ã–º –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
map.addLayer({
    'id': 'tower20',
    'type': 'model',
    'slot': 'middle',
    'source': 'model20',
    'minzoom': 18.3,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },
    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],


        18.3, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18.5, 0.4, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            18.6, 0.5,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
20, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
21, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
22, 0.7,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
24, 0.7  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5



        ],


       'model-rotation': [0, 0.0, -155.8],
        'model-scale': [1215.5, 1120.0, 1170],
        'model-color-mix-intensity': 0,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 0.0],
        'model-emissive-strength': 0.99
    }
});











// –î–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ GLB-—Ñ–∞–π–ª–∞ –≤–µ—Ä—Ö–Ω–∏–π –í–∫—É—Å–í–∏–ª–ª
map.addSource('model21', {
    'type': 'geojson',
    'data': {
        'type': 'Feature',
        'properties': {
            'model-uri': 'https://sos.emiia.ai/VV_VERH_GLB.glb' // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ URL –≤—Ç–æ—Ä–æ–≥–æ GLB
        },
        'geometry': {
           'coordinates': [37.6357745,55.8383770], // –î—Ä—É–≥–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
            'type': 'Point'
        }
    }
});






map.addLayer({
    'id': 'tower21',
    'type': 'model',
    'slot': 'middle',
    'source': 'model21',
    'minzoom': 15,
    'maxzoom': 24,
    'layout': {
        'model-id': ['get', 'model-uri']
    },



    'paint': {
        'model-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],
            17, 0,    // –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (0%) –Ω–∞ –∑—É–º–µ 17
            18, 0.1, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
18.5, 0.9, // –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (50%) –Ω–∞ –∑—É–º–µ 17.75
            19, 1,  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
19.5, 1  // 90% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ (90%) –Ω–∞ –∑—É–º–µ 18.5
        ],

        'model-rotation': [0, 0.0, -155.8],
        'model-scale': [1215.5, 1120.0, 1170],
        'model-color-mix-intensity': 1,
        'model-cast-shadows': true,
        'model-translation': [0, 0, 6.9],
        'model-emissive-strength': 0.9



    }
});




































}); // –ó–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞















  















map.on('load', () => {
    map.addSource('polygon-source', {
        type: 'geojson',
        data: {
            type: 'Feature',
            geometry: {
                type: 'Polygon',
                coordinates: [[
                    [37.174014825136595, 55.97747637225763],
                    [37.174223117007614, 55.97745607738463],
                    [37.17408018404612, 55.97699461722809],
                    [37.173873474273904, 55.977014791684724],
                    [37.174014825136595, 55.97747637225763]
                ]]
            },
            properties: {
                height: 6.9 // –≤—ã—Å–æ—Ç–∞ —ç–∫—Å—Ç—Ä—É–∑–∏–∏ (–Ω–∞–¥ –±–∞–∑–æ–π)
            }
        }
    });

    map.addLayer({
        id: 'extruded-polygon',
        type: 'fill-extrusion',
        source: 'polygon-source',
        paint: {
            'fill-extrusion-color': '#e4e4e4',
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': 3.85,
          


        'fill-extrusion-opacity': [
            'interpolate',
            ['linear'],
            ['zoom'],
           




17.9, 0.007,

18.0, 0.009,
 
18.1, 0.2, 



        ],







            'fill-extrusion-ambient-occlusion-intensity': 0 // –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–Ω–∏
        }
    });


// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–Ω–µ–π
    map.setLight({
        intensity: 0.03// –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±–∏—Ä–∞–µ—Ç —Ç–µ–Ω–∏
    });

});


















map.on('load', () => {
    map.addSource('polygon-source1', {
        type: 'geojson',
        data: {
            type: 'Feature',
            geometry: {
                type: 'Polygon',
                coordinates: [[
                    [37.174014825136595, 55.97747637225763],
                    [37.174223117007614, 55.97745607738463],
                    [37.17408018404612, 55.97699461722809],
                    [37.173873474273904, 55.977014791684724],
                    [37.174014825136595, 55.97747637225763]
                ]]
            },
            properties: {
                height: 3.95 // –≤—ã—Å–æ—Ç–∞ —ç–∫—Å—Ç—Ä—É–∑–∏–∏ (–Ω–∞–¥ –±–∞–∑–æ–π)
            }
        }
    });

    map.addLayer({
        id: 'extruded-polygon1',
        type: 'fill-extrusion',
        source: 'polygon-source1',
        paint: {
            'fill-extrusion-color': '#0047AB',
            'fill-extrusion-height': ['get', 'height'],
            'fill-extrusion-base': 3.95,
            'fill-extrusion-opacity': 0.2,


            'fill-extrusion-ambient-occlusion-intensity': 0.1 // –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–Ω–∏
        }
    }, '3d-buildings');




});
















</script>











<script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
function updateValues() {
  // –û–±–Ω–æ–≤–ª—è–µ–º VOC (—Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É 255 –∏ 260)
  const vocElement = document.getElementById('vocValue');
  const currentVoc = parseInt(vocElement.textContent);
  const newVoc = currentVoc + Math.floor(Math.random() * 5) - 2; // ¬±2 –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
  vocElement.textContent = Math.max(255, Math.min(260, newVoc)); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω 255-260
  
  // –û–±–Ω–æ–≤–ª—è–µ–º CO2 (—Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–∂–¥—É 553 –∏ 560)
  const co2Element = document.getElementById('co2Value');
  const currentCo2 = parseInt(co2Element.textContent);
  const newCo2 = currentCo2 + Math.floor(Math.random() * 5) - 2; // ¬±2 –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
  co2Element.textContent = Math.max(553, Math.min(560, newCo2)); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω 553-560
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É (–Ω–µ–±–æ–ª—å—à–∏–µ –∫–æ–ª–µ–±–∞–Ω–∏—è –≤–æ–∫—Ä—É–≥ 26.0)
  const tempElement = document.getElementById('temperatureValue');
  const currentTemp = parseFloat(tempElement.textContent);
  const variation = (Math.random() - 0.5) * 0.4; // ¬±0.2 –≥—Ä–∞–¥—É—Å–∞
  const newTemp = Math.round((26.0 + variation) * 10) / 10;
  tempElement.textContent = newTemp.toFixed(1);
}

// –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
setInterval(updateValues, 3000);
</script>

<script>
// –û–±–Ω–æ–≤–ª—è–µ–º –®—É–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(function() {
  const noiseElement = document.getElementById('noiseValue');

  if (noiseElement) {
    const currentNoise = parseFloat(noiseElement.textContent);
    const noiseVariation = (Math.random() - 0.5) * 3; // ¬±1.5 –µ–¥–∏–Ω–∏—Ü—ã
    const newNoise = Math.round((currentNoise + noiseVariation) * 100) / 100;
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω 40-46 –¥–ª—è —à—É–º–∞
    noiseElement.textContent = Math.max(40, Math.min(46, newNoise)).toFixed(2);
  }
}, 1000);
</script>









<script>
// –û–±–Ω–æ–≤–ª—è–µ–º –ü–ª–æ—Ç–Ω–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏ –≠–ú–ò –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
setInterval(function() {
  const radioWavesElement = document.getElementById('RadioWaves');
  if (radioWavesElement) {
    const values = [0.035, 0.033, 0.042, 0.055];
    const randomIndex = Math.floor(Math.random() * values.length);
    radioWavesElement.textContent = values[randomIndex].toFixed(3);
  }
}, 1000);
</script>





<script>


// –û–ß–ï–ù–¨ –í–ê–ñ–ù–´–ô –ë–õ–û–ö

map.on('style.load', () => {
        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 0,
            'maxzoom': 24
        });

        // add the DEM source as a terrain layer
        map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 0.0 });

 
 
// –í–´–¢–ê–í–õ–Ø–ï–ú –ó–ï–ú–õ–Æ –ù–ê -1 





map.addSource('geojson', {
            'type': 'geojson',
            'lineMetrics': true,
            'data': {
                'type': 'Feature',
                'properties': {
                    // add an array of elevation values.
                    // the number of values doesn't need to match the number of coordinates.
                    'elevation': [
                        -4, 4, 5, 5.5, 4, 3, 0
                    ]
                },
                'geometry': {
                    'coordinates': [
                            [37.630907830210646, 55.8339924045205],
                            [37.6309770003019, 55.834026416653444],
                            [37.63102306010572, 55.83405016143769],
                            [37.63103528399293, 55.83401619712731]
                    ],
                    'type': 'LineString'
                }
            }
        });

        // add the elevated line layer

// –õ–∏–Ω–∏—é –¥–µ–ª–∞–µ–º 0
        map.addLayer({
            'id': 'elevated-line',
            'type': 'line',
            'source': 'geojson',
            'layout': {
                'line-z-offset': [
                    'at-interpolated',
                    [
                        '*',
                        ['line-progress'],
                        ['-', ['length', ['get', 'elevation']], 1]
                    ],
                    ['get', 'elevation']
                ],
                'line-elevation-reference': 'sea'
            },
            'paint': {
                'line-emissive-strength': 1.0,
                'line-width': 8.0,
                'line-color': 'royalblue'
            }
        });
    });













// –±–µ–≥—É—â–∞—è –ª–∏–Ω–∏—è

    const geojson = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'properties': {},
                'geometry': {
                    'coordinates': [
                        

                           [37.63088726, 55.83399153],
                            [37.6309893,55.83404027],
                            [37.6309878,55.83406037],
                           [37.63098217,55.83407239],
                         
                            [37.63095,55.83411],
                            [37.63092323,55.83413374],
                            [37.63100719,55.83417627],
                            [37.63107888,55.83421063],
                            [37.63116048,55.83425289],
                            [37.6312313,55.83420817],
                            [37.63129053,55.83417114],
                            [37.6312401,55.8341485],

 [37.63112045,55.83408876],
 [37.63109693,55.83404414],
 [37.63103578,55.83401419]
                    ],
                    'type': 'LineString'
                }
            }
        ]
    };

    map.on('load', () => {
        map.addSource('line', {
            type: 'geojson',
            data: geojson
        });

        // add a line layer without line-dasharray defined to fill the gaps in the dashed line
        map.addLayer({
            type: 'line',
            source: 'line',

 'minzoom': 19,
        'maxzoom': 22,
            id: 'line-background',
            paint: {
                'line-color': '#c3ea4a',
                'line-width': 9,
                'line-opacity': 0.8
            }
        });

        // add a line layer with line-dasharray set to the first value in dashArraySequence
        map.addLayer({
            type: 'line',
            source: 'line',


 'minzoom': 19,
        'maxzoom': 24,


            id: 'line-dashed',
            paint: {
                'line-color': '#f8f9fa',
                'line-width': 6,
                'line-dasharray': [0, 4, 3],
                'line-emissive-strength': 1
            }
        });

        // technique based on https://jsfiddle.net/2mws8y3q/
        // an array of valid line-dasharray values, specifying the lengths of the alternating dashes and gaps that form the dash pattern
        const dashArraySequence = [
            [0, 4, 3],
            [0.5, 4, 2.5],
            [1, 4, 2],
            [1.5, 4, 1.5],
            [2, 4, 1],
            [2.5, 4, 0.5],
            [3, 4, 0],
            [0, 0.5, 3, 3.5],
            [0, 1, 3, 3],
            [0, 1.5, 3, 2.5],
            [0, 2, 3, 2],
            [0, 2.5, 3, 1.5],
            [0, 3, 3, 1],
            [0, 3.5, 3, 0.5]
        ];

        let step = 0;

        function animateDashArray(timestamp) {
            // Update line-dasharray using the next value in dashArraySequence. The
            // divisor in the expression `timestamp / 50` controls the animation speed.
            const newStep = parseInt(
                (timestamp / 50) % dashArraySequence.length
            );

            if (newStep !== step) {
                map.setPaintProperty(
                    'line-dashed',
                    'line-dasharray',
                    dashArraySequence[step]
                );
                step = newStep;
            }

            // Request the next frame of the animation.
            requestAnimationFrame(animateDashArray);
        }

        // start the animation
        animateDashArray(0);
    });






</script>


















 

       





<script>
// –£–¥–∞–ª—è–µ–º –í–°–ï —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ mousemove
map.off('mousemove');

// –ï–î–ò–ù–´–ô –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
map.on('mousemove', (e) => {
  const info = document.getElementById('info');
  if (!info) return;

  // 1. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
  const point = {Z: Math.round(e.point.x), Y: Math.round(e.point.y)};
  const lngLat = {Lng: e.lngLat.lng.toFixed(8), Lat: e.lngLat.lat.toFixed(8)};

  // 2. Zoom, Pitch –∏ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (–ù–û–í–û–ï: –ø–∏—Ç—á –¥–æ–±–∞–≤–ª–µ–Ω)
  const zoom = map.getZoom().toFixed(2);
  const pitch = map.getPitch().toFixed(1);  // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ: –ù–∞–∫–ª–æ–Ω –∫–∞—Ä—Ç—ã
  const elevation = map.queryTerrainElevation(e.lngLat);
  const heightAboveSea = elevation !== null ? Math.round(elevation) : '‚Äî';

  // 3. –í—ã—Å–æ—Ç–∞ –Ω–∞–¥ –∑–µ–º–ª—ë–π (–∏–∑ 3D –∑–¥–∞–Ω–∏–π)
  let heightAboveGround = 0;
  
  const features = map.queryRenderedFeatures(e.point, {
    layers: ['3d-buildings', 'building', 'extruded-layer', 'layer-with-pulsing-dot-1', 'layer-with-pulsing-dot-2']
  });
  
  if (features.length > 0) {
    const feature = features.find(f => f.properties.height || f.properties.render_height);
    if (feature) {
      heightAboveGround = feature.properties.height || feature.properties.render_height;
    }
  }

  // 4. –°–æ–±–∏—Ä–∞–µ–º –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (–ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω–æ —Ç–∏—Ä–µ –ø–æ—Å–ª–µ H)
  let mainLine = `Z: ${zoom}, P: ${pitch}, H: 110 –º.`;
  
  if (heightAboveGround > 0) {
    mainLine += `, E: ${heightAboveGround} –º.`;
  } else {
    mainLine += `, E: 0 –º.`;
  }

  // 5. –í—Å—Ç–∞–≤–ª—è–µ–º –≤ DOM (–±–µ–∑ –º–µ—Ä—Ü–∞–Ω–∏—è)
  info.innerHTML = JSON.stringify(point) + '<br>' + 
                   JSON.stringify(lngLat) + '<br>' +
                   mainLine;
});
</script>

   

































<div class="header">
    <a class="header" href="javascript:void(0)" onclick="showPopup()" 
   style="display: inline-block; padding: 0px; border-radius: 20px; transition: all 0.2s ease; "

   onmouseout="this.style.background='none'; this.style.transform='scale(1)';"
   ontouchstart="this.style.background='rgba(61, 133, 198, 0.08)'; this.style.transform='scale(0.98)';"
   ontouchend="this.style.background='none'; this.style.transform='scale(1)';">






        <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 100 100" id="wave" data-name="Layer 1">
            <path id="Line_1" data-name="Line 1" fill="#3D85C6" stroke="#3D85C6" d="m49.244102 60.047245l0 0c-0.20874405 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -19.33857c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 19.33857c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_1" data-name="Line 1" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m49.244102 60.047245l0 0c-0.20874405 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -19.33857c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 19.33857c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_2" data-name="Line 2" fill="#3D85C6" stroke="#3D85C6" d="m41.362213 65.66929l0 0c-0.20874405 0 -0.3779602 -0.16921234 -0.3779602 -0.3779602l0 -30.58266c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921997 0.3779602 0.3779602l0 30.58266c0 0.20874786 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_2" data-name="Line 2" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m41.362213 65.66929l0 0c-0.20874405 0 -0.3779602 -0.16921234 -0.3779602 -0.3779602l0 -30.58266c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921997 0.3779602 0.3779602l0 30.58266c0 0.20874786 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_3" data-name="Line 3" fill="#3D85C6" stroke="#3D85C6" d="m33.480324 55.842518l0 0c-0.20874405 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -10.929115c0 -0.100242615 0.03981781 -0.19638062 0.110702515 -0.2672615c0.07088089 -0.07088089 0.16701508 -0.1106987 0.2672577 -0.1106987l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 10.929115l0 0c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_3" data-name="Line 3" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m33.480324 55.842518l0 0c-0.20874405 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -10.929115c0 -0.100242615 0.03981781 -0.19638062 0.110702515 -0.2672615c0.07088089 -0.07088089 0.16701508 -0.1106987 0.2672577 -0.1106987l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 10.929115l0 0c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_4" data-name="Line 4" fill="#3D85C6" stroke="#3D85C6" d="m57.12599 61.92126l0 0c-0.20874023 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -23.086601c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 23.086601l0 0c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_4" data-name="Line 4" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m57.12599 61.92126l0 0c-0.20874023 0 -0.3779602 -0.16921997 -0.3779602 -0.3779602l0 -23.086601c0 -0.1002388 0.039821625 -0.1963768 0.110702515 -0.2672577c0.07088089 -0.07088089 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874405 0 0.3779602 0.16921997 0.3779602 0.3779602l0 23.086601l0 0c0 0.20874023 -0.16921616 0.3779602 -0.3779602 0.3779602z" fill-rule="evenodd"/>
            <path id="Line_5" data-name="Line 5" fill="#3D85C6" stroke="#3D85C6" d="m65.00788 54.897636l0 0c-0.20874023 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -9.039352c0 -0.100242615 0.03981781 -0.1963768 0.110702515 -0.2672577c0.070884705 -0.070884705 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 9.039352c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z"/>
            <path id="Line_5" data-name="Line 5" fill="#3D85C6" stroke="#3D85C6" stroke-width="1.0" stroke-linejoin="round" stroke-linecap="butt" d="m65.00788 54.897636l0 0c-0.20874023 0 -0.3779602 -0.16921616 -0.3779602 -0.3779602l0 -9.039352c0 -0.100242615 0.03981781 -0.1963768 0.110702515 -0.2672577c0.070884705 -0.070884705 0.16701508 -0.110702515 0.2672577 -0.110702515l1.511795 0c0.20874023 0 0.3779602 0.16921616 0.3779602 0.3779602l0 9.039352c0 0.20874405 -0.16921997 0.3779602 -0.3779602 0.3779602z"/>
        </svg>
    </a>
</div>


<div id="popup" onclick="closePopupByBackdrop(event)" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px); z-index: 10000; font-family: 'Montserrat', sans-serif; ">



          
 <div id="popup-content" onclick="event.stopPropagation()" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(204, 204, 204, 0.7); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 30px; border-radius: 36px; max-width: 400px; width: 85%; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border: 0px solid #f8f9fa;">





               <!-- –ö—Ä–µ—Å—Ç–∏–∫ –≤ –≤–µ—Ä—Ö–Ω–µ–º –ø—Ä–∞–≤–æ–º —É–≥–ª—É -->
        <button class="mapboxgl-popup-close-button" onclick="closePopup()" 
                style="position: fixed; top: 10px; right: 10px; color: #f8f9fa; font-size: 28px; padding: 14px; margin: 0; border: none; background: none; border-radius: 12px; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; cursor: pointer; z-index: 10001;"

                onmouseover="this.style.background='rgba(128, 128, 128, 0.1)'; this.style.color='#666'; this.style.transform='scale(1.05)';"
                onmouseout="this.style.background='none'; this.style.color='#f8f9fa'; this.style.transform='scale(1)';"
                ontouchstart="this.style.background='rgba(128, 128, 128, 0.0)'; this.style.color='#666'; this.style.transform='scale(0.95)';"
                ontouchend="this.style.background='none'; this.style.color='#f8f9fa'; this.style.transform='scale(1)';">
            √ó
        </button>







        <h3 style="margin-top: 0; color: #f8f9fa; font-family: 'Montserrat', sans-serif; font-weight: 500; font-size: 20px;">EMIIA.AI LLM: AI WMS <br><strong>DARK STORE #33</strong></h3>
        <div style="background: rgba(204, 204, 204, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px); padding: 20px; border-radius: 30px; margin-bottom: 25px; border: 1px solid #f8f9fa; ">

            <p style="line-height: 2; color: #f8f9fa; font-family: 'Montserrat', sans-serif; font-size: 14px; margin: 0;  font-weight: 600;">
                <strong style="color: #f8f9fa;  font-weight: 600;">–ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:</strong><br> <strong style="color: #f8f9fa;  font-weight: 600;"><svg xmlns="http://www.w3.org/2000/svg" width="5" height="5" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16" style="vertical-align: 3px; display: inline-block;">
  <circle cx="8" cy="8" r="8"/>
</svg> ‚ùØ&emsp;EMIIA.AI TAI</strong>  ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–≥–µ–Ω—Ç<br>

<strong style="color: #f8f9fa; font-weight: 600;"> 

<svg xmlns="http://www.w3.org/2000/svg" width="5" height="5" fill="currentColor" class="bi bi-circle-fill" viewBox="0 0 16 16" style="vertical-align: 3px; display: inline-block;">
  <circle cx="8" cy="8" r="8"/>
</svg> ‚ùØ&emsp;EMIIA.AI OAI</strong>  ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç<br>



<strong style="color: #f8f9fa; font-weight: 600;">–°—É–±–∞–≥–µ–Ω—Ç—ã:</strong><br>

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16" style="vertical-align: -3px; display: inline-block;">
<path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
 <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
</svg>&emsp;<strong style="color: #f8f9fa;  font-weight: 600;">EMIIA.AI MAP</strong> ‚Äî —Ü–∏—Ñ—Ä–æ–≤—ã–µ –¥–≤–æ–π–Ω–∏–∫–∏ <br> 


        

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16" style="vertical-align: -3px; display: inline-block;">
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5zM0 11.5A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5zM8.5 5a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5zM0 11.5A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm4.5.5a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5zm1.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5z"/>
</svg><strong style="color: #f8f9fa;  font-weight: 600;">&emsp;EMIIA.AI API</strong> ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π API-—à–ª—é–∑ <br>

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16" style="vertical-align: -3px; display: inline-block;">
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411"/>
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M8 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999zm2.493 8.574a.5.5 0 0 1-.411.575c-.712.118-1.28.295-1.655.493a1.3 1.3 0 0 0-.37.265.3.3 0 0 0-.057.09V14l.002.008.016.033a.6.6 0 0 0 .145.15c.165.13.435.27.813.395.751.25 1.82.414 3.024.414s2.273-.163 3.024-.414c.378-.126.648-.265.813-.395a.6.6 0 0 0 .146-.15l.015-.033L12 14v-.004a.3.3 0 0 0-.057-.09 1.3 1.3 0 0 0-.37-.264c-.376-.198-.943-.375-1.655-.493a.5.5 0 1 1 .164-.986c.77.127 1.452.328 1.957.594C12.5 13 13 13.4 13 14c0 .426-.26.752-.544.977-.29.228-.68.413-1.116.558-.878.293-2.059.465-3.34.465s-2.462-.172-3.34-.465c-.436-.145-.826-.33-1.116-.558C3.26 14.752 3 14.426 3 14c0-.599.5-1 .961-1.243.505-.266 1.187-.467 1.957-.594a.5.5 0 0 1 .575.411"/>
</svg><strong style="color: #f8f9fa;  font-weight: 600;">&emsp;EMIIA.AI MRV</strong> ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è <br>

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16" style="vertical-align: -3px; display: inline-block;">
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M6 6.207v9.043a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H6.236a1 1 0 0 1-.447-.106l-.33-.165A.83.83 0 0 1 5 2.488V.75a.75.75 0 0 0-1.5 0v2.083c0 .715.404 1.37 1.044 1.689L5.5 5c.32.32.5.754.5 1.207"/>
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.5" 
        fill="none"
        d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M6 6.207v9.043a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H6.236a1 1 0 0 1-.447-.106l-.33-.165A.83.83 0 0 1 5 2.488V.75a.75.75 0 0 0-1.5 0v2.083c0 .715.404 1.37 1.044 1.689L5.5 5c.32.32.5.754.5 1.207"/>
 <path fill="#f8f9fa" d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>



</svg><strong style="color: #f8f9fa;  font-weight: 600;">&emsp;EMIIA.AI SOS</strong> ‚Äî –ø–æ–º–æ—â—å (–ß–°) <br>

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16" style="vertical-align: -3px; display: inline-block;">
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z"/>
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z"/>
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M10 7a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V9a1 1 0 0 0-1-1"/>
  
  <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞ -->
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z"/>
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z"/>
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M10 7a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V9a1 1 0 0 0-1-1"/>
</svg><strong style="color: #f8f9fa;  font-weight: 600;">&emsp;EMIIA.AI SAI</strong> ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞  <br> 

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 -1 16 16" style="vertical-align: -3px; display: inline-block;">
  <path fill-rule="evenodd" 
        stroke="#f8f9fa" 
        stroke-width="0.4" 
        fill="none"
        d="M0 0h1v15h15v1H0zm14.817 11.887a.5.5 0 0 0 .07-.704l-4.5-5.5a.5.5 0 0 0-.74-.037L7.06 8.233 3.404 3.206a.5.5 0 0 0-.808.588l4 5.5a.5.5 0 0 0 .758.06l2.609-2.61 4.15 5.073a.5.5 0 0 0 .704.07"/>
  
  <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–ª–∏–≤–∫–∞ -->
  <path fill-rule="evenodd" 
        fill="#f8f9fa" 
        d="M0 0h1v15h15v1H0zm14.817 11.887a.5.5 0 0 0 .07-.704l-4.5-5.5a.5.5 0 0 0-.74-.037L7.06 8.233 3.404 3.206a.5.5 0 0 0-.808.588l4 5.5a.5.5 0 0 0 .758.06l2.609-2.61 4.15 5.073a.5.5 0 0 0 .704.07"/>
</svg><strong style="color: #f8f9fa;  font-weight: 600;">&emsp;EMIIA.AI AAI</strong> ‚Äî –∞—É–¥–∏—Ç<br>

            </p>
        </div>



     <button onclick="window.open('https://sos.emiia.ai/vv3', '_self')"
        style="background: #bababaf8; color: #f8f9fa; border: none; padding: 16px 32px; border-radius: 18px; cursor: pointer; width: 100%; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 16px; transition: all 0.2s ease; transform: scale(1); min-height: 50px;
               -webkit-tap-highlight-color: transparent; outline: none;"
        onmousedown="this.style.transform='scale(0.95)'; this.style.background='#bababad8';"
        onmouseup="this.style.transform='scale(1)'; this.style.background='#bababaf8';"
        onmouseover="this.style.background='#bababad8'; this.style.transform='scale(1.02)';"
        onmouseout="this.style.background='#bababaf8'; this.style.transform='scale(1)';"
        ontouchstart="this.style.transform='scale(0.95)'; this.style.background='#bababad8';"
        ontouchend="this.style.transform='scale(1)'; this.style.background='#bababaf8';">


    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16" style="position: relative; top: 0px; vertical-align: -0.125em; margin-right: 8px;">
  <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
  <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
</svg>EMIIA.AI LLM
</button>





        
    </div>
</div>
















<script>
// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —à—Ä–∏—Ñ—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
const fontLink = document.createElement('link');
fontLink.href = 'https://fonts.googleapis.com/css2?family=Montserrat:cyrillic,wght@0,400;0,500;0,600;1,400;1,500;1,600&display=swap';
fontLink.rel = 'stylesheet';
document.head.appendChild(fontLink);

// –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —à—Ä–∏—Ñ—Ç–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–ø–∞–ø–∞
let fontLoaded = false;
const font = new FontFace('Montserrat', 'url(https://fonts.gstatic.com/s/montserrat/v25/JTUSjIg1_i6t8kCHKm459WlhyyTh89Y.woff2)');

font.load().then(function(loadedFont) {
    document.fonts.add(loadedFont);
    fontLoaded = true;
}).catch(function(error) {
    console.log('Font loading failed: ', error);
    fontLoaded = true;
});

function showPopup() {
    // –ï—Å–ª–∏ —à—Ä–∏—Ñ—Ç –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∂–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
    if (!fontLoaded) {
        setTimeout(showPopup, 100);
        return;
    }
    
    const popup = document.getElementById('popup');
    const popupContent = document.getElementById('popup-content');
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∏—Å–∫–ª—é—á–∞—è –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è)
    const title = popupContent.querySelector('h3');
    const description = popupContent.querySelector('div');
    const button = popupContent.querySelector('button[onclick*="window.open"]');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
    [title, description, button].forEach(element => {
        if (element) {
            element.style.opacity = '0';
            element.style.transform = 'translateY(20px)';
            element.style.transition = 'all 0.5s ease';
        }
    });
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    popupContent.style.opacity = '1';
    popupContent.style.transform = 'translate(-50%, -50%) scale(1)';
    popupContent.style.transition = 'all 0.3s ease';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º popup
    popup.style.display = 'block';
    adjustForMobile();
    
    // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    setTimeout(() => {
        if (title) {
            title.style.opacity = '1';
            title.style.transform = 'translateY(0)';
        }
    }, 100);
    
    setTimeout(() => {
        if (description) {
            description.style.opacity = '1';
            description.style.transform = 'translateY(0)';
        }
    }, 300);
    
    setTimeout(() => {
        if (button) {
            button.style.opacity = '1';
            button.style.transform = 'translateY(0)';
        }
    }, 500);
}

function closePopup() {
    const popup = document.getElementById('popup');
    const popupContent = document.getElementById('popup-content');
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ–≥–æ –±–ª–æ–∫–∞
    popupContent.style.opacity = '0';
    popupContent.style.transform = 'translate(-50%, -50%) scale(0.8)';
    popupContent.style.transition = 'all 0.3s ease';
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        popup.style.display = 'none';
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        popupContent.style.opacity = '';
        popupContent.style.transform = '';
        popupContent.style.transition = '';
    }, 300);
}

function closePopupByBackdrop(event) {
    if (event.target === document.getElementById('popup')) {
        closePopup();
    }
}

function adjustForMobile() {
    const content = document.getElementById('popup-content');
    
    if (window.innerWidth <= 768) {
        content.style.width = 'calc(100% - 80px)';
        content.style.maxWidth = '320px';
        content.style.padding = '25px';
    } else {
        content.style.width = '85%';
        content.style.maxWidth = '300px';
        content.style.padding = '30px';
    }
}

// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
document.addEventListener('DOMContentLoaded', function() {
    adjustForMobile();
    const popup = document.getElementById('popup');
    popup.style.display = 'none';
});

window.addEventListener('resize', adjustForMobile);
</script>


<style>
#popup-content h3,
#popup-content div,
#popup-content button[onclick*="window.open"] {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

#popup-content {
    transition: all 0.3s ease !important;
}
</style>







<style>
.loader {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
}
#wave path {
  fill: #818cf8;
  transform-origin: 50% 50%;
  animation: pulse 1s infinite;
}
#wave.stop path {
  animation-play-state: paused;
}

#wave #Line_1 { animation-delay: 0.0s; }
#wave #Line_2 { animation-delay: 0.15s; }
#wave #Line_3 { animation-delay: 0.3s; }
#wave #Line_4 { animation-delay: 0.45s; }
#wave #Line_5 { animation-delay: 0.6s; }


@keyframes pulse {
  0%   { transform: scaleY(1);}
  50%  { transform: scaleY(0.7);}
  100% { transform: scaleY(1);}
}



/* –î–µ—Å–∫—Ç–æ–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
textarea::placeholder {
    color: #E2E8F0 !important;
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è */
@media (max-width: 640px) {
    textarea::placeholder {
        color: #E2E8F0 !important; /* –ü—Ä–∏–º–µ—Ä –¥—Ä—É–≥–æ–≥–æ —Ü–≤–µ—Ç–∞ –¥–ª—è –º–æ–±–∏–ª–æ–∫ */
    }





</style>




































<style>
@import url('https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

	<style>
@import url('https://www.emiia.ru/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

  <style>  
@import url('/css.css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap&subset=cyrillic');
</style>

<link rel="stylesheet" href="https://www.emiia.ru/cssfamily=Montserrat.css">
<link rel="stylesheet" href="/cssfamily=Montserrat.css">









 




</div>
</div>








<!-- –°–ö–†–ò–ü–¢ –≠–ö–°–¢–†–£–ó–ò–ò (4 –ó–û–ù–´) -->
<script>
(function() {
    'use strict';
    
    const EXTRUSION_HEIGHT = 4.5;
    const EXTRUSION_OPACITY = 0.5;
    
    // –í—Å–µ 4 –∑–æ–Ω—ã
    const zones = [
        // –ó–æ–Ω–∞ 1 —Ç–æ—á–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ ‚Ññ1
        [[37.63562028,55.83848023],
         [37.63565139, 55.83852160],
         [37.63569232, 55.83851084],
         [37.63566214,55.83846955],
         [37.63562028,55.83848023]],

        // –ó–æ–Ω–∞ 2 –∫—É—Ä—å–µ—Ä—ã
        [[37.63579566, 55.83836359],
         [37.63582623, 55.83840300],
         [37.63590614,55.83838327],
         [37.63587510, 55.83834421],
         [37.63579566, 55.83836359]],


        // –ó–æ–Ω–∞ 3 –Ω–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è —Ä–æ–±–æ—Ç
        [[37.63564016, 55.83828259],
         [37.63569513,55.83835382],
         [37.63576039,55.83833700],
         [37.63570430, 55.83826678],
         [37.63564016, 55.83828259]],
        
       
        // –ó–æ–Ω–∞ 4
        [[37.63586790,55.83850825],
         [37.63582291, 55.83851879],
         [37.63585426,55.83856156],
         [37.63590079,55.83855028],
         [37.63586790,55.83850825]]
    ];
    
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã
    if (!map.loaded()) {
        map.on('load', initZones);
    } else {
        initZones();
    }
    
    function initZones() {
        zones.forEach((polygon, index) => {
            const zoneId = `extrusion-zone-${index + 1}`;
            
            // –°–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
            map.addSource(zoneId + '-src', {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': [polygon]
                    },
                    'properties': {'height': EXTRUSION_HEIGHT}
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º —Å–ª–æ–π
            map.addLayer({
                'id': zoneId,
                'type': 'fill-extrusion',
                'source': zoneId + '-src',
                'minzoom': 17,
                'paint': {
                    'fill-extrusion-color': '#90EE90',
                    'fill-extrusion-height': ['get', 'height'],
                    'fill-extrusion-base': 0,
                    'fill-extrusion-opacity': 0,
                    'fill-extrusion-vertical-gradient': false
                }
            });
        });
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
        setInterval(checkZones, 50);
    }
    
    function checkZones() {
        zones.forEach((polygon, index) => {
            const zoneId = `extrusion-zone-${index + 1}`;
            let anyInside = false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–∫–∏
            ['dot-point-1', 'dot-point-2'].forEach(pointId => {
                try {
                    const source = map.getSource(pointId);
                    if (source && source._data && source._data.features && source._data.features[0]) {
                        const coords = source._data.features[0].geometry.coordinates;
                        if (pointInPolygon(coords, polygon)) {
                            anyInside = true;
                        }
                    }
                } catch(e) {}
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
            const opacity = anyInside ? EXTRUSION_OPACITY : 0;
            try {
                map.setPaintProperty(zoneId, 'fill-extrusion-opacity', opacity);
            } catch(e) {}
        });
    }
    
    function pointInPolygon(point, vs) {
        const x = point[0], y = point[1];
        let inside = false;
        for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            const xi = vs[i][0], yi = vs[i][1];
            const xj = vs[j][0], yj = vs[j][1];
            const intersect = ((yi > y) !== (yj > y)) &&
                (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
        return inside;
    }
    
})();
</script>








<!-- –í–°–¢–ê–í–¨–¢–ï –í –ö–û–ù–ï–¶ </body>, –ü–ï–†–ï–î –ó–ê–ö–†–´–í–ê–Æ–©–ò–ú –¢–ï–ì–û–ú -->

<script>
// === –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–°–ï–ú–ò SVG –°–õ–û–Ø–ú–ò ===
(function() {
    'use strict';
    
    // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    window.svgLayersHidden = true; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –°–ö–†–´–¢–´
    
    // –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ —Å–ª–æ–∏
    const svgLayers = [
        'layer-1', 'layer-2', 'layer-3', 'layer-4', 'layer-5', 'layer-6',
        'stop-points-layer-1', 'stop-points-layer-2',
        'passed-route-line-1', 'passed-route-line-2',
        'future-route-line-1', 'future-route-line-2',
        'line-background', 'line-dashed'
    ];
    
    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞
    window.toggleAllSVGLayers = function() {
        window.svgLayersHidden = !window.svgLayersHidden;
        
        svgLayers.forEach(function(layerId) {
            try {
                if (map.getLayer(layerId)) {
                    // –ì–ª–∞–≤–Ω–æ–µ ‚Äî opacity –≤ paint, visibility –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
                    var layer = map.getLayer(layerId);
                    
                    if (layer.type === 'symbol') {
                        map.setPaintProperty(layerId, 'icon-opacity', window.svgLayersHidden ? 0 : 1);
                    }
                    else if (layer.type === 'line') {
                        map.setPaintProperty(layerId, 'line-opacity', window.svgLayersHidden ? 0 : 1);
                    }
                    
                    map.setLayoutProperty(layerId, 'visibility', window.svgLayersHidden ? 'none' : 'visible');
                }
            } catch(e) {}
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª –∫–Ω–æ–ø–∫–∏
        var btn = document.querySelector('[data-action="messages"]');
        if (btn) {
            btn.style.background = window.svgLayersHidden ? '' : 'rgba(144, 238, 144, 0.3)';
        }
        
        console.log('SVG:', window.svgLayersHidden ? '–°–ö–†–´–¢–´' : '–ü–û–ö–ê–ó–ê–ù–´');
    };
    
    // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
    function initialHide() {
        svgLayers.forEach(function(layerId) {
            try {
                if (map.getLayer(layerId)) {
                    var layer = map.getLayer(layerId);
                    
                    if (layer.type === 'symbol') {
                        map.setPaintProperty(layerId, 'icon-opacity', 0);
                    }
                    else if (layer.type === 'line') {
                        map.setPaintProperty(layerId, 'line-opacity', 0);
                    }
                    
                    map.setLayoutProperty(layerId, 'visibility', 'none');
                }
            } catch(e) {}
        });
    }
    
    // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    function init() {
        // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å—ë
        initialHide();
        
        var btn = document.querySelector('[data-action="messages"]');
        if (!btn) {
            setTimeout(init, 300);
            return;
        }
        
        // –ß–∏—Å—Ç—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
        btn.onclick = function(e) {
            e.stopPropagation();
            e.preventDefault();
            window.toggleAllSVGLayers();
            
            // –ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é
            var menu = document.getElementById('dotsMenu');
            var overlay = document.getElementById('dotsOverlay');
            if (menu) {
                menu.style.display = 'none';
                if (overlay) overlay.style.display = 'none';
            }
        };
        
        console.log('‚úÖ SVG –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω');
    }
    
    // –ó–∞–ø—É—Å–∫
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
    
    // –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
    setTimeout(init, 500);
    setTimeout(init, 1000);
    
})();
</script>

<style>
.menu-item-with-icon[data-action="messages"]:hover { background: #cccccc69; }
</style>







<script>
// === –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –§–£–ù–ö–¶–ò–ô –û–ë–ù–û–í–õ–ï–ù–ò–Ø –¢–û–ß–ï–ö –û–°–¢–ê–ù–û–í–û–ö ===
// –≠—Ç–æ—Ç –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è refreshStopPointsLayer1/2

(function() {
    'use strict';
    
    // –ñ–¥—ë–º, –ø–æ–∫–∞ Mapbox –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è
    function waitForMapboxAndOverride() {
        if (typeof map === 'undefined' || !map.getSource || typeof refreshStopPointsLayer1 !== 'function') {
            setTimeout(waitForMapboxAndOverride, 100);
            return;
        }
        
        console.log('üîÑ –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–æ—á–µ–∫ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫...');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        const originalRefresh1 = window.refreshStopPointsLayer1;
        const originalRefresh2 = window.refreshStopPointsLayer2;
        
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é 1
        window.refreshStopPointsLayer1 = function() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–ª–æ–π –µ—Å–ª–∏ –µ—Å—Ç—å
            if (map.getLayer('stop-points-layer-1')) {
                map.removeLayer('stop-points-layer-1');
            }
            
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Å —É—á—ë—Ç–æ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
            const isVisible = window.svgLayersGlobalVisible;
            
            map.addLayer({
                'id': 'stop-points-layer-1',
                'type': 'symbol',
                'source': 'stop-points-1',
                'minzoom': 20,
                'layout': {
                    'icon-image': ['case',
                        ['==', ['get', 'isCompleted'], true], 'gray-dot',
                        'red-dot'
                    ],
                    'icon-offset': [0, 0],
                    'icon-allow-overlap': true,
                    'icon-ignore-placement': true,
                    'visibility': isVisible ? 'visible' : 'none'
                },
                'paint': {
                    'icon-opacity': isVisible ? 1 : 0
                }
            }, 'layer-with-pulsing-dot-1');
        };
        
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é 2
        window.refreshStopPointsLayer2 = function() {
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–ª–æ–π –µ—Å–ª–∏ –µ—Å—Ç—å
            if (map.getLayer('stop-points-layer-2')) {
                map.removeLayer('stop-points-layer-2');
            }
            
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Å —É—á—ë—Ç–æ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
            const isVisible = window.svgLayersGlobalVisible;
            
            map.addLayer({
                'id': 'stop-points-layer-2',
                'type': 'symbol',
                'source': 'stop-points-2',
                'minzoom': 20,
                'layout': {
                    'icon-image': ['case',
                        ['==', ['get', 'isCompleted'], true], 'gray-dot',
                        'red-dot'
                    ],
                    'icon-offset': [0, 0],
                    'icon-allow-overlap': true,
                    'icon-ignore-placement': true,
                    'visibility': isVisible ? 'visible' : 'none'
                },
                'paint': {
                    'icon-opacity': isVisible ? 1 : 0
                }
            }, 'stop-points-layer-1');
        };
        
        console.log('‚úÖ –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã');
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    waitForMapboxAndOverride();
    
})();
</script>





</body>
</html>
























